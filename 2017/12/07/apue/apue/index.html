<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="1 I/O    1.1 &amp;#x6587;&amp;#x4EF6; I/O   &amp;#x901A;&amp;#x8FC7;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x6807;&amp;#x8BC6;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;&amp;#x800C;&amp;#x8A00;&amp;#xFF0C;&amp;#x6240;&amp;#x67">
<meta name="keywords" content="Linux,C">
<meta property="og:type" content="article">
<meta property="og:title" content="Advanced Programming in the UNIX Environment">
<meta property="og:url" content="https://kylestones.github.io/2017/12/07/apue/apue/index.html">
<meta property="og:site_name" content="All in Org-mode">
<meta property="og:description" content="1 I/O    1.1 &amp;#x6587;&amp;#x4EF6; I/O   &amp;#x901A;&amp;#x8FC7;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x6807;&amp;#x8BC6;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;&amp;#x800C;&amp;#x8A00;&amp;#xFF0C;&amp;#x6240;&amp;#x67">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-09-24T06:52:00.714Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Advanced Programming in the UNIX Environment">
<meta name="twitter:description" content="1 I/O    1.1 &amp;#x6587;&amp;#x4EF6; I/O   &amp;#x901A;&amp;#x8FC7;&amp;#x6587;&amp;#x4EF6;&amp;#x63CF;&amp;#x8FF0;&amp;#x7B26;&amp;#x6807;&amp;#x8BC6;&amp;#x3002;&amp;#x5BF9;&amp;#x4E8E;&amp;#x5185;&amp;#x6838;&amp;#x800C;&amp;#x8A00;&amp;#xFF0C;&amp;#x6240;&amp;#x67">






  <link rel="canonical" href="https://kylestones.github.io/2017/12/07/apue/apue/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Advanced Programming in the UNIX Environment | All in Org-mode</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">All in Org-mode</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Keep it Simple, Stuped.</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://kylestones.github.io/2017/12/07/apue/apue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kyle Three Stone">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/polarbear.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="All in Org-mode">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Advanced Programming in the UNIX Environment
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-07 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-07T00:00:00+08:00">2017-12-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-09-24 14:52:00" itemprop="dateModified" datetime="2018-09-24T14:52:00+08:00">2018-09-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="post-meta-item-icon"
            >
            <i class="fa fa-eye"></i>
             Views:  
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">94k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">1:false</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <div id="content">


<div id="outline-container-orgb87e177" class="outline-2">
<h2 id="orgb87e177"><span class="section-number-2">1</span> I/O</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgbb7b4f4" class="outline-3">
<h3 id="orgbb7b4f4"><span class="section-number-3">1.1</span> &#x6587;&#x4EF6; I/O</h3>
<div class="outline-text-3" id="text-1-1">
<p>
&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x6807;&#x8BC6;&#x3002;&#x5BF9;&#x4E8E;&#x5185;&#x6838;&#x800C;&#x8A00;&#xFF0C;&#x6240;&#x6709;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#x90FD;&#x901A;&#x8FC7;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x5F15;&#x7528;&#x3002;
&#x5176;&#x4E5F;&#x662F;&#x6709;&#x7F13;&#x51B2;&#x7684;&#xFF0C;&#x53EA;&#x662F;&#x5176;&#x7F13;&#x51B2;&#x533A;&#x5728;&#x5185;&#x6838;&#x7A7A;&#x95F4;&#xFF0C;&#x4E0D;&#x518D;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x3002;&#x4F53;&#x73B0;&#x5728;&#x5EF6;&#x8FDF;&#x5199;&#xFF0C;&#x53EA;&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x5019;&#x624D;&#x8C03;&#x7528;&#x5199;&#x6587;&#x4EF6;&#x64CD;&#x4F5C;&#xFF0C;
&#x51CF;&#x5C11;&#x4E0D;&#x5FC5;&#x8981;&#x7684;&#x5199;&#x64CD;&#x4F5C;&#xFF0C;&#x589E;&#x52A0;&#x6027;&#x80FD;&#x3002;
&#x51FD;&#x6570; open() &#x6253;&#x5F00;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x6307;&#x5B9A;&#x6A21;&#x5F0F;&#x5FC5;&#x987B;&#x6709;&#x4E14;&#x4EC5;&#x6709; O _RDONLY / O _WRONLY / O _RDWR &#x4E09;&#x8005;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x3002;
&#x9009;&#x9879; O _APPEND &#x6307;&#x5B9A;&#x4E3A;&#x8FFD;&#x52A0;&#x3002;&#x539F;&#x6765;&#x7684; UNIX &#x7CFB;&#x7EDF;&#x4E0D;&#x652F;&#x6301;&#x8FFD;&#x52A0;&#xFF0C;&#x53EA;&#x80FD;&#x5148;&#x4F7F;&#x7528; lseek() &#x5148;&#x8BBE;&#x7F6E;&#x6587;&#x4EF6;&#x7684;&#x504F;&#x79FB;&#x91CF;&#x5230;&#x6587;&#x4EF6;&#x7684;
&#x7ED3;&#x5C3E;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x5199;&#x3002;&#x4F46;&#x662F;&#x8FD9;&#x5728;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x540C;&#x65F6;&#x5199;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x51FA;&#x95EE;&#x9898;&#xFF0C;&#x56E0;&#x4E3A;&#x8C03;&#x7528;&#x4E86;&#x4E24;&#x4E2A;&#x51FD;&#x6570;&#x6765;&#x8FFD;&#x52A0;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x3002;
&#x800C;&#x8FFD;&#x52A0;&#x9009;&#x9879;&#x786E;&#x4FDD;&#x8BBE;&#x7F6E;&#x504F;&#x79FB;&#x548C;&#x5199;&#x64CD;&#x4F5C;&#x4E3A;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x3002;
</p>
</div>

<div id="outline-container-orge82eb6c" class="outline-4">
<h4 id="orge82eb6c"><span class="section-number-4">1.1.1</span> &#x7BA1;&#x9053;&#x8BFB;&#x5199;</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
&#x5199;&#x7BA1;&#x9053;&#x7684;&#x65F6;&#x5019;&#x4E0D;&#x7528;&#x4F7F;&#x7528;&#x8FFD;&#x52A0;&#x9009;&#x9879;&#xFF0C;&#x5185;&#x6838;&#x4F1A;&#x81EA;&#x52A8;&#x6309;&#x5199;&#x7684;&#x987A;&#x5E8F;&#x5199;&#x5165;&#x7BA1;&#x9053;&#x3002;&#x8BFB;&#x53D6;&#x540E;&#x81EA;&#x52A8;&#x5C06;&#x76F8;&#x5E94;&#x7684;&#x5185;&#x5BB9;&#x4ECE;&#x7BA1;&#x9053;&#x6E05;&#x9664;&#x3002;
&#x8BFB;&#x53D6;&#x4E00;&#x4E2A;&#x5199;&#x7AEF;&#x5173;&#x95ED;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x5728;&#x8BFB;&#x53D6;&#x5B8C;&#x5168;&#x90E8;&#x6570;&#x636E;&#x540E;&#xFF0C;read &#x51FD;&#x6570;&#x8FD4;&#x56DE; 0 &#xFF1B;
&#x5199;&#x4E00;&#x4E2A;&#x8BFB;&#x7AEF;&#x5173;&#x95ED;&#x7684;&#x7BA1;&#x9053;&#xFF0C;&#x4EA7;&#x751F; SIGPIPE &#x4FE1;&#x53F7;&#xFF0C;&#x8BBE;&#x7F6E;&#x8BE5;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x6216;&#x8005;&#x5FFD;&#x7565;&#x8BE5;&#x4FE1;&#x53F7;&#xFF0C;write &#x8FD4;&#x56DE; -1&#xFF0C;&#x4E14; errno
&#x8BBE;&#x7F6E;&#x4E3A; EPIPE&#x3002;
&#x8BFB;&#x7BA1;&#x9053;&#xFF0C;&#x5982;&#x679C;&#x7BA1;&#x9053;&#x4E3A;&#x7A7A;&#xFF0C;&#x8C03;&#x7528;&#x7EBF;&#x7A0B;&#x963B;&#x585E;&#xFF0C;&#x540C;&#x8FDB;&#x7A0B;&#x5185;&#x7684;&#x5176;&#x4ED6;&#x7EBF;&#x7A0B;&#x4E0D;&#x53D7;&#x5F71;&#x54CD;&#x3002;
</p>
</div>
</div>

<div id="outline-container-orgd9fe3a4" class="outline-4">
<h4 id="orgd9fe3a4"><span class="section-number-4">1.1.2</span> &#x5957;&#x63A5;&#x5B57;&#x63CF;&#x8FF0;&#x7B26;</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
&#x867D;&#x7136;&#x5957;&#x63A5;&#x5B57;&#x63CF;&#x8FF0;&#x7B26;&#x672C;&#x8D28;&#x4E0A;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x4F46;&#x4E0D;&#x662F;&#x6240;&#x6709;&#x53C2;&#x6570;&#x4E3A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x51FD;&#x6570;&#x90FD;&#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x5957;&#x63A5;&#x5B57;&#x63CF;&#x8FF0;&#x7B26;&#x3002;
&#x5957;&#x63A5;&#x5B57;&#x4E0D;&#x652F;&#x6301;&#x6587;&#x4EF6;&#x504F;&#x79FB;&#x91CF;&#x6982;&#x5FF5;&#xFF0C;&#x4E0D;&#x80FD;&#x4F7F;&#x7528; lseek &#x51FD;&#x6570;&#xFF0C;&#x4E5F;&#x4E0D;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; mmap &#x51FD;&#x6570;&#xFF0C;&#x4E0D;&#x53EF;&#x8C03;&#x7528; fchdir &#x51FD;&#x6570;&#x3002;
</p>

<p>
shutdown &#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x5173;&#x95ED;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x7684;&#x8BFB;&#x7AEF;&#x6216;&#x8005;&#x5199;&#x7AEF;&#xFF0C;&#x4E0D;&#x7BA1;&#x8BE5;&#x5957;&#x63A5;&#x5B57;&#x63CF;&#x8FF0;&#x7B26;&#x590D;&#x5236;&#x4E86;&#x591A;&#x5C11;&#x5206;&#xFF1B;
close &#x51FD;&#x6570;&#x53EA;&#x6709;&#x5728;&#x5173;&#x95ED;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5957;&#x63A5;&#x5B57;&#x7684;&#x65F6;&#x5019;&#x624D;&#x4F1A;&#x91CA;&#x653E;&#x8BE5;&#x5957;&#x63A5;&#x5B57;&#x3002;
</p>
</div>
</div>

<div id="outline-container-org3cc09c9" class="outline-4">
<h4 id="org3cc09c9"><span class="section-number-4">1.1.3</span> &#x6539;&#x53D8;&#x6587;&#x4EF6;&#x504F;&#x79FB;&#x91CF;</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
lseek
</p>
</div>
</div>
</div>

<div id="outline-container-orga4edab8" class="outline-3">
<h3 id="orga4edab8"><span class="section-number-3">1.2</span> &#x6807;&#x51C6;&#x5E93; I/O</h3>
<div class="outline-text-3" id="text-1-2">
<p>
&#x6807;&#x51C6; I/O &#x5E93;&#x7684;&#x64CD;&#x4F5C;&#x56F4;&#x7ED5;&#x6D41;(stream)&#x8FDB;&#x884C;&#x3002;&#x5229;&#x7528;&#x6307;&#x5411; FILE &#x5BF9;&#x8C61;&#x7EF4;&#x62A4;&#xFF0C;&#x8BE5;&#x7ED3;&#x6784;&#x4F53;&#x5305;&#x542B;&#x4E86;&#x6807;&#x51C6; I/O &#x5E93;&#x4E3A;&#x4E86;&#x7EF4;&#x62A4;&#x8BE5;&#x6D41;&#x6240;
&#x9700;&#x8981;&#x7684;&#x4FE1;&#x606F;&#xFF1A;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x6307;&#x5411;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x957F;&#x5EA6;&#xFF0C;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x5F53;&#x524D;&#x7684;&#x5B57;&#x7B26;&#x6570;&#xFF0C;&#x51FA;&#x9519;&#x6807;&#x5FD7;&#x7B49;&#x3002;&#x4E0D;&#x9700;&#x8981;&#x5173;&#x5FC3;
FILE &#x7ED3;&#x6784;&#x7684;&#x5177;&#x4F53;&#x5F62;&#x5F0F;&#x3002;
&#x76F8;&#x5BF9;&#x4E8E;&#x6587;&#x4EF6; I/O&#xFF0C;&#x6807;&#x51C6;&#x5E93;&#x7684; I/O &#x90FD;&#x662F;&#x5E26;&#x7F13;&#x51B2;&#x7684;&#xFF0C;&#x6807;&#x51C6;&#x5E93;&#x7EF4;&#x62A4;&#x4E86;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;&#xFF0C;&#x5728;&#x9002;&#x5F53;&#x7684;&#x65F6;&#x5019;&#x624D;&#x8C03;&#x7528; read&#x3001;write &#x51FD;
&#x6570;&#xFF0C;&#x4ECE;&#x800C;&#x51CF;&#x5C11;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x7684;&#x5F00;&#x9500;&#x3002;
</p>
</div>

<div id="outline-container-org7410985" class="outline-4">
<h4 id="org7410985"><span class="section-number-4">1.2.1</span> &#x5B9A;&#x4F4D;&#x6D41;</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
ftell&#x3001;fseek&#x3001;ftello&#x3001;fseek&#x3001;fgetpos&#x3001;fsetpos
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org7db7ee9" class="outline-2">
<h2 id="org7db7ee9"><span class="section-number-2">2</span> IPC</h2>
<div class="outline-text-2" id="text-2">
<p>
IPC &#x4F20;&#x7EDF;&#x4E0A;&#x662F; UNIX &#x4E2D;&#x4E00;&#x4E2A;&#x6742;&#x4E71;&#x4E0D;&#x582A;&#x7684;&#x9886;&#x57DF;&#xFF0C;&#x867D;&#x7136;&#x6709;&#x4E86;&#x5404;&#x79CD;&#x5404;&#x6837;&#x7684;&#x89E3;&#x51B3;&#x529E;&#x6CD5;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x4E00;&#x4E2A;&#x662F;&#x5B8C;&#x7F8E;&#x7684;&#x3002;&#x53EF;&#x5206;&#x4E3A;&#x56DB;&#x4E2A;&#x4E3B;
&#x8981;&#x9886;&#x57DF;&#xFF1A;
</p>
<ol class="org-ol">
<li>&#x6D88;&#x606F;&#x4F20;&#x9012; : &#x7BA1;&#x9053;&#x3001;FIFO&#x3001;&#x6D88;&#x606F;&#x961F;&#x5217;</li>
<li>&#x540C;&#x6B65; : &#x4E92;&#x65A5;&#x9501;&#x3001;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;&#x8BFB;&#x5199;&#x9501;&#x3001;&#x4FE1;&#x53F7;&#x91CF;</li>
<li>&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A; : &#x533F;&#x540D;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x3001;&#x547D;&#x4EE4;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;</li>
<li>&#x8FC7;&#x7A0B;&#x8C03;&#x7528; : Solaris &#x95E8;&#x3001;Sun RPC</li>
</ol>
<p>
&#x5305;&#x62EC;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;&#x5185;&#x591A;&#x4E2A;&#x7EBF;&#x7A0B;&#x7684; IPC &#x548C;&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x95F4;&#x7684; IPC &#x3002;
</p>
</div>
<div id="outline-container-org5fe9390" class="outline-3">
<h3 id="org5fe9390"><span class="section-number-3">2.1</span> &#x6D88;&#x606F;&#x8FB9;&#x754C;</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org8d03930" class="outline-4">
<h4 id="org8d03930"><span class="section-number-4">2.1.1</span> &#x65E0;&#x8FB9;&#x754C;</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
&#x7BA1;&#x9053;&#x548C; FIFO &#x662F;&#x5B57;&#x8282;&#x6D41;&#xFF0C;&#x6CA1;&#x6709;&#x6D88;&#x606F;&#x8FB9;&#x754C;&#xFF1B;
TCP &#x6CA1;&#x6709;&#x8BB0;&#x5F55;&#x8FB9;&#x754C;&#x7684;&#x5B57;&#x8282;&#x6D41;&#xFF1B;
</p>
</div>
</div>
<div id="outline-container-orga879a28" class="outline-4">
<h4 id="orga879a28"><span class="section-number-4">2.1.2</span> &#x6709;&#x8FB9;&#x754C;</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
POSIX &#x6D88;&#x606F;&#x548C; System V &#x6D88;&#x606F;&#x6709;&#x4ECE;&#x53D1;&#x9001;&#x8005;&#x5411;&#x63A5;&#x6536;&#x8005;&#x7EF4;&#x62A4;&#x7684;&#x8FB9;&#x754C;&#xFF1B;
UDP &#x63D0;&#x4F9B;&#x5177;&#x6709;&#x8FB9;&#x754C;&#x8BB0;&#x5F55;&#x7684;&#x6D88;&#x606F;&#xFF1B;
</p>
</div>
</div>
</div>
<div id="outline-container-orgd154507" class="outline-3">
<h3 id="orgd154507"><span class="section-number-3">2.2</span> &#x7AA5;&#x63A2;&#x80FD;&#x529B;</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org2585eac" class="outline-4">
<h4 id="org2585eac"><span class="section-number-4">2.2.1</span> &#x53EF;&#x4EE5;&#x7AA5;&#x63A2;</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
socket
recv&#x3001;recvfrom &#x51FD;&#x6570;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6807;&#x5FD7; MSG _PEEK &#x4ECE;&#x63A5;&#x6536;&#x961F;&#x5217;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x4E14;&#x7CFB;&#x7EDF;&#x4E0D;&#x5728;&#x8BFB;&#x53D6;&#x4E4B;&#x540E;&#x4E22;&#x5F03;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#xFF1B;
</p>
</div>
</div>
<div id="outline-container-org79eae5f" class="outline-4">
<h4 id="org79eae5f"><span class="section-number-4">2.2.2</span> &#x4E0D;&#x53EF;&#x7AA5;&#x63A2;</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
&#x7BA1;&#x9053;&#x3001;FIFO&#x3001;POSIX &#x6D88;&#x606F;&#x3001;System V &#x6D88;&#x606F;
&#x53EA;&#x6709;&#x4E00;&#x4E2A;&#x526F;&#x672C;&#x9012;&#x4EA4;&#x5230;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E14;&#x6D88;&#x606F;&#x4E0D;&#x80FD;&#x5E7F;&#x64AD;&#x6216;&#x591A;&#x64AD;&#x5230;&#x591A;&#x4E2A;&#x63A5;&#x6536;&#x8005;&#xFF08;UDP &#x5E7F;&#x64AD;&#x3001;&#x591A;&#x64AD;&#xFF09;
</p>
</div>
</div>
</div>
<div id="outline-container-org2c1da2a" class="outline-3">
<h3 id="org2c1da2a"><span class="section-number-3">2.3</span> &#x8BFB;&#x53D6;&#x987A;&#x5E8F;</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org1e3e343" class="outline-4">
<h4 id="org1e3e343"><span class="section-number-4">2.3.1</span> &#x5148;&#x8FDB;&#x5148;&#x51FA;</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
&#x7BA1;&#x9053;&#x3001;FIFO
</p>
</div>
</div>
<div id="outline-container-org4661108" class="outline-4">
<h4 id="org4661108"><span class="section-number-4">2.3.2</span> &#x4F18;&#x5148;&#x7EA7;&#x6700;&#x9AD8;&#x7684;&#x6700;&#x65E9;&#x6D88;&#x606F;</h4>
<div class="outline-text-4" id="text-2-3-2">
<p>
POSIX &#x6D88;&#x606F;
</p>
</div>
</div>
<div id="outline-container-orgfa8c17a" class="outline-4">
<h4 id="orgfa8c17a"><span class="section-number-4">2.3.3</span> &#x6307;&#x5B9A;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x6D88;&#x606F;</h4>
<div class="outline-text-4" id="text-2-3-3">
<p>
System V &#x6D88;&#x606F;
</p>
</div>
</div>
</div>
<div id="outline-container-orgaf617a9" class="outline-3">
<h3 id="orgaf617a9"><span class="section-number-3">2.4</span> &#x5BF9;&#x8C61;&#x6301;&#x7EED;&#x6027;</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-orgec91aec" class="outline-4">
<h4 id="orgec91aec"><span class="section-number-4">2.4.1</span> &#x968F;&#x8FDB;&#x7A0B;&#x6301;&#x7EED; process-persistent</h4>
<div class="outline-text-4" id="text-2-4-1">
<p>
IPC &#x5BF9;&#x8C61;&#x4E00;&#x76F4;&#x5B58;&#x5728;&#x5230;&#x6253;&#x5F00;&#x7740;&#x8BE5;&#x5BF9;&#x8C61;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5173;&#x95ED;&#x8BE5;&#x5BF9;&#x8C61;&#x4E3A;&#x6B62;&#x3002;&#x6CA1;&#x6709; unlink &#x51FD;&#x6570;&#x3002;
&#x7BA1;&#x9053;&#x3001;FIFO&#x3001;POSIX &#x4E92;&#x65A5;&#x9501;&#x3001;POSIX &#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;POSIX &#x8BFB;&#x5199;&#x9501;&#x3001;POSIX &#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x4FE1;&#x53F7;&#x91CF;&#x3001;fcntl &#x8BB0;&#x5F55;&#x9501;&#x3001;TCP &#x5957;
&#x63A5;&#x5B57;&#x3001;UDP &#x5957;&#x63A5;&#x5B57;&#x3001;Unix &#x57DF;&#x5957;&#x63A5;&#x5B57;
</p>
</div>
</div>
<div id="outline-container-orgbbefa79" class="outline-4">
<h4 id="orgbbefa79"><span class="section-number-4">2.4.2</span> &#x968F;&#x5185;&#x6838;&#x6301;&#x7EED; kernel-persistent</h4>
<div class="outline-text-4" id="text-2-4-2">
<p>
&#x4E00;&#x76F4;&#x5B58;&#x5728;&#x5230;&#x5185;&#x6838;&#x91CD;&#x65B0;&#x81EA;&#x4E3E;&#x6216;&#x663E;&#x793A;&#x5220;&#x9664;&#x8BE5; IPC &#x5BF9;&#x8C61;&#x3002;&#x5B58;&#x5728;&#x5BF9;&#x5E94;&#x7684; unlink &#x51FD;&#x6570;&#x3002;
POSIX &#x6D88;&#x606F;&#x961F;&#x5217;&#x3001;POSIX &#x6709;&#x540D;&#x4FE1;&#x53F7;&#x91CF;&#x3001;POSIX &#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x3001;System V &#x6D88;&#x606F;&#x961F;&#x5217;&#x3001;System V &#x4FE1;&#x53F7;&#x91CF;&#x3001;System V &#x5171;
&#x4EAB;&#x5185;&#x5B58;
</p>
</div>
</div>
<div id="outline-container-orgea6a375" class="outline-4">
<h4 id="orgea6a375"><span class="section-number-4">2.4.3</span> &#x968F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x6301;&#x7EED; filesystem-persistent</h4>
<div class="outline-text-4" id="text-2-4-3">
<p>
&#x4E00;&#x76F4;&#x5B58;&#x5728;&#x5230;&#x663E;&#x793A;&#x5220;&#x9664;&#x8BE5; IPC &#x5BF9;&#x8C61;&#x4E3A;&#x6B62;&#x3002;
IPC &#x7684;&#x4E00;&#x4E2A;&#x57FA;&#x672C;&#x8BBE;&#x8BA1;&#x76EE;&#x6807;&#x662F;&#x9AD8;&#x6027;&#x80FD;&#xFF0C;&#x800C;&#x5177;&#x5907;&#x968F;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x7684;&#x6301;&#x7EED;&#x6027;&#x53EF;&#x80FD;&#x4F1A;&#x4F7F;&#x5176;&#x6027;&#x80FD;&#x964D;&#x7EA7;&#xFF0C;&#x800C;&#x4E14;&#x8FDB;&#x7A0B;&#x4E0D;&#x53EF;&#x80FD;&#x8DE8;&#x8D8A;&#x81EA;&#x4E3E;&#x7EE7;
&#x7EED;&#x5B58;&#x6D3B;&#x3002;
</p>
</div>
</div>
</div>
<div id="outline-container-orgf2059e8" class="outline-3">
<h3 id="orgf2059e8"><span class="section-number-3">2.5</span> &#x540D;&#x5B57;&#x7A7A;&#x95F4; &#x2013; name space</h3>
<div class="outline-text-3" id="text-2-5">
<p>
&#x4E00;&#x79CD;&#x7ED9;&#x5B9A;&#x7684; IPC &#x7C7B;&#x578B;&#xFF0C;&#x5176;&#x53EF;&#x80FD;&#x540D;&#x5B57;&#x7684;&#x96C6;&#x5408;&#x79F0;&#x4E3A;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x3002;&#x540D;&#x5B57;&#x7A7A;&#x95F4;&#x975E;&#x5E38;&#x91CD;&#x8981;&#xFF0C;&#x56E0;&#x4E3A;&#x540D;&#x5B57;&#x662F;&#x5BA2;&#x6237;&#x4E0E;&#x670D;&#x52A1;&#x5668;&#x5F7C;&#x6B64;&#x8FDE;&#x63A5;
&#x4EE5;&#x4EA4;&#x6362;&#x6D88;&#x606F;&#x7684;&#x624B;&#x6BB5;&#x3002;
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">IPC &#x7C7B;&#x578B;</th>
<th scope="col" class="org-left">&#x6253;&#x5F00;&#x6216;&#x521B;&#x5EFA; IPC &#x7684;&#x540D;&#x5B57;&#x7A7A;&#x95F4;</th>
<th scope="col" class="org-left">IPC &#x6253;&#x5F00;&#x540E;&#x7684;&#x6807;&#x8BC6;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#x7BA1;&#x9053;</td>
<td class="org-left">NA</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">FIFO</td>
<td class="org-left">&#x8DEF;&#x5F84;&#x540D;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">POSIX &#x4E92;&#x65A5;&#x9501;</td>
<td class="org-left">NA</td>
<td class="org-left">pthread _mutex _t &#x6307;&#x9488;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x6761;&#x4EF6;&#x53D8;&#x91CF;</td>
<td class="org-left">NA</td>
<td class="org-left">pthread _cond _t &#x6307;&#x9488;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x8BFB;&#x5199;&#x9501;</td>
<td class="org-left">NA</td>
<td class="org-left">pthread _rwlock _t &#x6307;&#x9488;</td>
</tr>

<tr>
<td class="org-left">fcntl &#x8BB0;&#x5F55;&#x4E0A;&#x9501;</td>
<td class="org-left">&#x8DEF;&#x5F84;&#x540D;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">POSIX &#x6D88;&#x606F;&#x961F;&#x5217;</td>
<td class="org-left">POSIX IPC &#x540D;&#x5B57;</td>
<td class="org-left">mqd _t &#x503C;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">POSIX IPC &#x540D;&#x5B57;</td>
<td class="org-left">sem _t &#x6307;&#x9488;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x5171;&#x4EAB;&#x5185;&#x5B58;</td>
<td class="org-left">POSIX IPC &#x540D;&#x5B57;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">NA</td>
<td class="org-left">sem _t &#x6307;&#x9488;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">TCP &#x5957;&#x63A5;&#x5B57;</td>
<td class="org-left">IP &#x5730;&#x5740;&#x4E0E; TCP &#x7AEF;&#x53E3;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">UDP &#x5957;&#x63A5;&#x5B57;</td>
<td class="org-left">IP &#x5730;&#x5740;&#x4E0E; UDP &#x7AEF;&#x53E3;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">Unix &#x57DF;&#x5957;&#x63A5;&#x5B57;</td>
<td class="org-left">&#x8DEF;&#x5F84;&#x540D;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">Sun RPC</td>
<td class="org-left">&#x7A0B;&#x5E8F;/&#x7248;&#x672C;</td>
<td class="org-left">RPC &#x53E5;&#x67C4;</td>
</tr>

<tr>
<td class="org-left">&#x95E8;</td>
<td class="org-left">&#x8DEF;&#x5F84;&#x540D;</td>
<td class="org-left">&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">System V &#x6D88;&#x606F;&#x961F;&#x5217;</td>
<td class="org-left">key _t &#x952E;</td>
<td class="org-left">System V IPC &#x6807;&#x8BC6;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">System V &#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">key _t &#x952E;</td>
<td class="org-left">System V IPC &#x6807;&#x8BC6;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">System V &#x5171;&#x4EAB;&#x5185;&#x5B58;</td>
<td class="org-left">key _t &#x952E;</td>
<td class="org-left">System V IPC &#x6807;&#x8BC6;&#x7B26;</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-orgd6fa158" class="outline-4">
<h4 id="orgd6fa158"><span class="section-number-4">2.5.1</span> &#x6253;&#x5F00; IPC &#x540D;&#x5B57;&#x7A7A;&#x95F4;</h4>
<div class="outline-text-4" id="text-2-5-1">
</div>
<ol class="org-ol">
<li><a id="org0303d8d"></a>&#x65E0;&#x540D; IPC<br>
<div class="outline-text-5" id="text-2-5-1-1">
<p>
&#x7BA1;&#x9053;&#x3001;POSIX &#x4E92;&#x65A5;&#x9501;&#x3001;POSIX &#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;POSIX &#x8BFB;&#x5199;&#x9501;&#x3001;POSIX &#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x4FE1;&#x53F7;&#x91CF;&#xFF1B;
</p>
</div>
<ol class="org-ol">
<li><a id="orgadc90a5"></a>&#x65E0;&#x540D; IPC &#x4E5F;&#x53EF;&#x4E3A;&#x8FDB;&#x7A0B;&#x6240;&#x5171;&#x4EAB;<br>
<div class="outline-text-6" id="text-2-5-1-1-1">
<p>
&#x4E92;&#x65A5;&#x9501;&#x3001;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;&#x8BFB;&#x5199;&#x9501;&#x3001;POSIX &#x65E0;&#x540D;&#x4FE1;&#x53F7;&#x91CF;&#x90FD;&#x662F;&#x65E0;&#x540D;&#x7684;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x4ED6;&#x4EEC;&#x662F;&#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x3002;&#x4ED6;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x4E3A;&#x5355;&#x4E2A;&#x8FDB;&#x7A0B;
&#x5185;&#x7684;&#x4E0D;&#x540C;&#x7EBF;&#x7A0B;&#x6240;&#x5171;&#x4EAB;&#xFF1B;&#x5F53;&#x4ED6;&#x4EEC;&#x5B58;&#x653E;&#x5728;&#x4E0D;&#x540C;&#x8FDB;&#x7A0B;&#x95F4;&#x6240;&#x5171;&#x4EAB;&#x7684;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x65F6;&#xFF0C;&#x540C;&#x65F6;&#x8BBE;&#x7F6E;&#x5176;&#x8FDB;&#x7A0B;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x4E3A;&#x8FD9;&#x4E9B;&#x8FDB;
&#x7A0B;&#x6240;&#x5171;&#x4EAB;&#x3002;
</p>
</div>
</li>
</ol>
</li>
<li><a id="org82baec4"></a>&#x6253;&#x5F00;&#x8DEF;&#x5F84;&#x540D; (path) &#x6765;&#x6253;&#x5F00; IPC<br>
<div class="outline-text-5" id="text-2-5-1-2">
<p>
FIFO&#x3001;fcntl&#x3001;Unix &#x57DF;&#x5957;&#x63A5;&#x5B57;&#x3001;&#x95E8;&#xFF1B;
</p>
</div>
</li>
<li><a id="org1577748"></a>&#x6253;&#x5F00; POSIX IPC &#x540D;&#x5B57;&#x6765;&#x6253;&#x5F00; IPC<br>
<div class="outline-text-5" id="text-2-5-1-3">
<p>
POSIX &#x6D88;&#x606F;&#x961F;&#x5217;&#x3001;POSIX &#x547D;&#x4EE4;&#x4FE1;&#x53F7;&#x91CF;&#x3001;POSIX &#x5171;&#x4EAB;&#x5185;&#x5B58;&#xFF1B;
</p>
</div>
</li>
<li><a id="org4418f9d"></a>&#x57FA;&#x4E8E; IP &#x5730;&#x5740;&#x548C;&#x7AEF;&#x53E3;&#x53F7;&#x6765;&#x6253;&#x5F00; IPC<br>
<div class="outline-text-5" id="text-2-5-1-4">
<p>
TCP &#x5957;&#x63A5;&#x5B57;&#x3001;UDP &#x5957;&#x63A5;&#x5B57;&#xFF1B;
</p>
</div>
</li>
<li><a id="orgbabf404"></a>&#x57FA;&#x4E8E; key _t &#x952E;&#x6253;&#x5F00; IPC<br>
<div class="outline-text-5" id="text-2-5-1-5">
<p>
System V &#x6D88;&#x606F;&#x961F;&#x5217;&#x3001;System V &#x4FE1;&#x53F7;&#x91CF;&#x3001;System V &#x5171;&#x4EAB;&#x5185;&#x5B58;&#xFF1B;
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgf932702" class="outline-4">
<h4 id="orgf932702"><span class="section-number-4">2.5.2</span> &#x6253;&#x5F00; IPC &#x540E;&#x7684;&#x6807;&#x8BC6;</h4>
<div class="outline-text-4" id="text-2-5-2">
</div>
<ol class="org-ol">
<li><a id="orgf60f242"></a>&#x63CF;&#x8FF0;&#x7B26;<br>
<div class="outline-text-5" id="text-2-5-2-1">
<p>
&#x7BA1;&#x9053;&#x3001;FIFO&#x3001;fcntl&#x3001;POSIX &#x5171;&#x4EAB;&#x5185;&#x5B58;&#x3001;TCP &#x5957;&#x63A5;&#x5B57;&#x3001;UDP &#x5957;&#x63A5;&#x5B57;&#x3001;Unix &#x865E;&#x57DF;&#x5957;&#x63A5;&#x5B57;&#x3001;&#x95E8;
</p>
</div>
</li>
<li><a id="org474b27b"></a>&#x76F8;&#x5E94;&#x5F62;&#x5F0F;&#x7684;&#x6307;&#x9488;<br>
<div class="outline-text-5" id="text-2-5-2-2">
<ul class="org-ul">
<li>POSIX &#x4E92;&#x65A5;&#x9501;</li>
<li>POSIX &#x6761;&#x4EF6;&#x53D8;&#x91CF;</li>
<li>POSIX &#x8BFB;&#x5199;&#x9501;</li>
<li>POSIX &#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</li>
<li>POSIX &#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x4FE1;&#x53F7;&#x91CF;</li>
</ul>
</div>
</li>
<li><a id="org17cc09e"></a>&#x503C;<br>
<div class="outline-text-5" id="text-2-5-2-3">
<ul class="org-ul">
<li>POSIX &#x6D88;&#x606F;&#x961F;&#x5217;</li>
</ul>
</div>
</li>
<li><a id="org8adad0d"></a>System V IPC &#x6807;&#x8BC6;&#x7B26;<br>
<div class="outline-text-5" id="text-2-5-2-4">
<ul class="org-ul">
<li>System V &#x6D88;&#x606F;&#x961F;&#x5217;</li>
<li>System V &#x4FE1;&#x53F7;&#x91CF;</li>
<li>System V &#x5171;&#x4EAB;&#x5185;&#x5B58;</li>
</ul>
</div>
</li>
<li><a id="org3c28c3e"></a>RPC &#x53E5;&#x67C4;<br>
<div class="outline-text-5" id="text-2-5-2-5">
<p>
Sun RPC
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgd7fba1c" class="outline-4">
<h4 id="orgd7fba1c"><span class="section-number-4">2.5.3</span> &#x9700;&#x8981;&#x5B9A;&#x4E49;&#x7ED3;&#x6784;&#x4F53;&#x53D8;&#x91CF;&#x2013;&#x6307;&#x9488;</h4>
<div class="outline-text-4" id="text-2-5-3">
<p>
&#x9664;&#x4E86; Posix &#x4FE1;&#x53F7;&#x91CF;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x6210;&#x6307;&#x9488;&#xFF0C;&#x5176;&#x4ED6;&#x7684;&#x90FD;&#x9700;&#x8981;&#x5B9A;&#x4E49;&#x6210;&#x53D8;&#x91CF;&#x3002;
</p>
</div>
<ol class="org-ol">
<li><a id="org2962bd8"></a>&#x7ED3;&#x6784;&#x4F53;<br>
<div class="outline-text-5" id="text-2-5-3-1">
<p>
&#x4E92;&#x65A5;&#x9501;&#x3001;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;&#x8BFB;&#x5199;&#x9501;&#x3001;Posix &#x65E0;&#x540D;&#x4FE1;&#x53F7;&#x91CF;&#x3001;Posix &#x6D88;&#x606F;&#x961F;&#x5217;&#x3001;
&#x63CF;&#x8FF0;&#x7B26;&#x3001;Posix &#x5171;&#x4EAB;&#x5185;&#x5B58;&#x3001;
</p>
</div>
</li>
<li><a id="orgd54589b"></a>&#x6307;&#x9488;<br>
<div class="outline-text-5" id="text-2-5-3-2">
<p>
Posix &#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;&#x3001;mmap&#x3001;
</p>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org2dd291d" class="outline-3">
<h3 id="org2dd291d"><span class="section-number-3">2.6</span> fork&#x3001;exec&#x3001;exit &#x5BF9; IPC &#x7684;&#x5F71;&#x54CD;</h3>
<div class="outline-text-3" id="text-2-6">
<ul class="org-ul">
<li>&#x65E0;&#x540D;&#x540C;&#x6B65;&#x53D8;&#x91CF;&#xFF08;&#x4E92;&#x65A5;&#x9501;&#x3001;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;&#x8BFB;&#x5199;&#x9501;&#x3001;&#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x4FE1;&#x53F7;&#x91CF;&#xFF09;&#xFF0C;&#x4ECE;&#x4E00;&#x4E2A;&#x5177;&#x6709;&#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x8FDB;&#x7A0B;&#x4E2D;&#x8C03;&#x7528; fork &#x5C06;&#x53D8;&#x5F97;
&#x6DF7;&#x4E71;&#x4E0D;&#x582A;&#xFF1B;&#x5982;&#x679C;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x9A7B;&#x7559;&#x5728;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#xFF0C;&#x800C;&#x4E14;&#x521B;&#x5EFA;&#x65F6;&#x8BBE;&#x7F6E;&#x4E86;&#x8FDB;&#x7A0B;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x90A3;&#x4E48;&#x5BF9;&#x4E8E;&#x80FD;&#x8BBF;&#x95EE;&#x8BE5;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x7684;
&#x4EFB;&#x610F;&#x8FDB;&#x7A0B;&#x6765;&#x8BF4;&#xFF0C;&#x5176;&#x4EFB;&#x610F;&#x7EBF;&#x7A0B;&#x80FD;&#x7EE7;&#x7EED;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x3002;</li>
<li>System V IPC &#x7684;&#x4E09;&#x79CD;&#x5F62;&#x5F0F;&#x6CA1;&#x6709;&#x6253;&#x5F00;&#x6216;&#x5173;&#x95ED;&#x7684;&#x8BF4;&#x6CD5;&#xFF0C;&#x53EA;&#x9700;&#x77E5;&#x9053;&#x5176;&#x6807;&#x8BC6;&#x7B26;&#x5373;&#x53EF;&#x8BBF;&#x95EE;&#x3002;</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">

<col class="org-left">

<col class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">IPC &#x7C7B;&#x578B;</th>
<th scope="col" class="org-left">fork</th>
<th scope="col" class="org-left">exec</th>
<th scope="col" class="org-left">_exit</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#x7BA1;&#x9053;&#x3001;FIFO</td>
<td class="org-left">&#x5B50;&#x8FDB;&#x7A0B;&#x53D6;&#x5F97;&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x526F;&#x672C;</td>
<td class="org-left">&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#xFF0C;&#x9664;&#x975E;&#x8BBE;&#x7F6E;&#x4E86; FD _CLOEXEC &#x4F4D;</td>
<td class="org-left">&#x5173;&#x95ED;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x5173;&#x95ED;&#x65F6;&#x5220;&#x9664;&#x7BA1;&#x9053;&#x6216; FIFO &#x4E2D;&#x6B8B;&#x7559;&#x7684;&#x6570;&#x636E;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x6D88;&#x606F;&#x961F;&#x5217;</td>
<td class="org-left">&#x5B50;&#x8FDB;&#x7A0B;&#x53D6;&#x5F97;&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x526F;&#x672C;</td>
<td class="org-left">&#x5173;&#x95ED;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x6D88;&#x606F;&#x961F;&#x5217;&#x63CF;&#x8FF0;&#x7B26;</td>
<td class="org-left">&#x5173;&#x95ED;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>

<tr>
<td class="org-left">System V &#x6D88;&#x606F;&#x961F;&#x5217;</td>
<td class="org-left">--</td>
<td class="org-left">--</td>
<td class="org-left">--</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">POSIX &#x4E92;&#x65A5;&#x9501;&#x548C;&#x6761;&#x4EF6;&#x53D8;&#x91CF;</td>
<td class="org-left">&#x82E5;&#x9A7B;&#x7559;&#x5728;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x5171;&#x4EAB;</td>
<td class="org-left">&#x9664;&#x975E;&#x5728;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5426;&#x5219;&#x6D88;&#x5931;</td>
<td class="org-left">&#x9664;&#x975E;&#x5728;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5426;&#x5219;&#x6D88;&#x5931;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x8BFB;&#x5199;&#x9501;</td>
<td class="org-left">&#x82E5;&#x9A7B;&#x7559;&#x5728;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x5171;&#x4EAB;</td>
<td class="org-left">&#x9664;&#x975E;&#x5728;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5426;&#x5219;&#x6D88;&#x5931;</td>
<td class="org-left">&#x9664;&#x975E;&#x5728;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5426;&#x5219;&#x6D88;&#x5931;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x57FA;&#x4E8E;&#x5185;&#x5B58;&#x7684;&#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">&#x82E5;&#x9A7B;&#x7559;&#x5728;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x5171;&#x4EAB;</td>
<td class="org-left">&#x9664;&#x975E;&#x5728;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5426;&#x5219;&#x6D88;&#x5931;</td>
<td class="org-left">&#x9664;&#x975E;&#x5728;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x4E2D;&#x800C;&#x4E14;&#x5177;&#x6709;&#x8FDB;&#x7A0B;&#x95F4;&#x5171;&#x4EAB;&#x5C5E;&#x6027;&#xFF0C;&#x5426;&#x5219;&#x6D88;&#x5931;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">&#x7236;&#x8FDB;&#x7A0B;&#x4E2D;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;</td>
<td class="org-left">&#x5173;&#x95ED;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">&#x5173;&#x95ED;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</td>
</tr>

<tr>
<td class="org-left">fcntl &#x8BB0;&#x5F55;&#x9501;</td>
<td class="org-left">&#x5B50;&#x8FDB;&#x7A0B;&#x4E0D;&#x7EE7;&#x627F;&#x7236;&#x8FDB;&#x7A0B;&#x6301;&#x6709;&#x7684;&#x9501;</td>
<td class="org-left">&#x53EA;&#x8981;&#x63CF;&#x8FF0;&#x7B26;&#x7EE7;&#x7EED;&#x6253;&#x5F00;&#x7740;&#xFF0C;&#x9501;&#x5C31;&#x4E0D;&#x53D8;</td>
<td class="org-left">&#x89E3;&#x5F00;&#x7531;&#x8FDB;&#x7A0B;&#x6301;&#x6709;&#x7684;&#x6240;&#x6709;&#x672A;&#x5904;&#x7406;&#x7684;&#x9501;</td>
</tr>

<tr>
<td class="org-left">System V &#x4FE1;&#x53F7;&#x91CF;</td>
<td class="org-left">&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#x6240;&#x6709; semadj &#x503C;&#x90FD;&#x7F6E;&#x4F4D; 0</td>
<td class="org-left">&#x6240;&#x6709; semadj &#x503C;&#x90FD;&#x643A;&#x5165;&#x65B0;&#x8FDB;&#x7A0B;</td>
<td class="org-left">&#x6240;&#x6709; semadj &#x503C;&#x90FD;&#x52A0;&#x5230;&#x76F8;&#x5E94;&#x7684;&#x4FE1;&#x53F7;&#x91CF;&#x503C;&#x4E0A;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">mmap &#x5185;&#x5B58;&#x6620;&#x5C04;</td>
<td class="org-left">&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5B58;&#x7559;&#x5230;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;</td>
<td class="org-left">&#x53BB;&#x9664;&#x5185;&#x5B58;&#x6620;&#x5C04;</td>
<td class="org-left">&#x53BB;&#x9664;&#x5185;&#x5B58;&#x6620;&#x5C04;</td>
</tr>

<tr>
<td class="org-left">POSIX &#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;</td>
<td class="org-left">&#x7236;&#x8FDB;&#x7A0B;&#x4E2D;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x5B58;&#x7559;&#x5230;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;</td>
<td class="org-left">&#x53BB;&#x9664;&#x5185;&#x5B58;&#x6620;&#x5C04;</td>
<td class="org-left">&#x53BB;&#x9664;&#x5185;&#x5B58;&#x6620;&#x5C04;</td>
</tr>

<tr>
<td class="org-left">System V &#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;</td>
<td class="org-left">&#x9644;&#x63A5;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x4E2D;&#x7EE7;&#x7EED;&#x9644;&#x63A5;&#x7740;</td>
<td class="org-left">&#x65AD;&#x5F00;&#x6240;&#x6709;&#x9644;&#x63A5;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;</td>
<td class="org-left">&#x65AD;&#x5F00;&#x6240;&#x6709;&#x9644;&#x63A5;&#x7740;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;</td>
</tr>
</tbody>
<tbody>
<tr>
<td class="org-left">&#x95E8;</td>
<td class="org-left">&#x5B50;&#x8FDB;&#x7A0B;&#x53D6;&#x5F97;&#x7236;&#x8FDB;&#x7A0B;&#x7684;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x4F46;&#x662F;&#x5BA2;&#x6237;&#x5728;&#x95E8;&#x63CF;&#x8FF0;&#x7B26;&#x4E0A;&#x6FC0;&#x6D3B;&#x5176;&#x8FC7;&#x7A0B;&#x65F6;&#xFF0C;&#x53EA;&#x6709;&#x7236;&#x8FDB;&#x7A0B;&#x662F;&#x670D;&#x52A1;&#x5668;</td>
<td class="org-left">&#x6240;&#x6709;&#x95E8;&#x63CF;&#x8FF0;&#x7B26;&#x90FD;&#x5E94;&#x5173;&#x95ED;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x4EEC;&#x521B;&#x5EFA;&#x65F6;&#x8BBE;&#x7F6E;&#x4E86; FD _CLOEXEC &#x4F4D;</td>
<td class="org-left">&#x5173;&#x95ED;&#x6240;&#x6709;&#x6253;&#x5F00;&#x7740;&#x7684;&#x63CF;&#x8FF0;&#x7B26;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-org6f0407f" class="outline-3">
<h3 id="org6f0407f"><span class="section-number-3">2.7</span> &#x9501;&#x91CA;&#x653E;</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-orgc21ee60" class="outline-4">
<h4 id="orgc21ee60"><span class="section-number-4">2.7.1</span> &#x5185;&#x6838;&#x81EA;&#x52A8;&#x91CA;&#x653E;</h4>
<div class="outline-text-4" id="text-2-7-1">
<p>
&#x6301;&#x6709;&#x67D0;&#x4E2A;&#x9501;&#x7684;&#x8FDB;&#x7A0B;&#x6CA1;&#x6709;&#x91CA;&#x653E;&#x5C31;&#x7EC8;&#x6B62;&#xFF0C;&#x5185;&#x6838;&#x81EA;&#x52A8;&#x91CA;&#x653E;&#x8BE5;&#x9501;&#xFF1B;
fcntl &#x8BB0;&#x5F55;&#x9501;&#x3001;System V &#x4FE1;&#x53F7;&#x91CF;&#xFF08;&#x53EF;&#x9009;&#x9879;&#xFF09;
</p>
</div>
</div>
<div id="outline-container-org89bbb47" class="outline-4">
<h4 id="org89bbb47"><span class="section-number-4">2.7.2</span> &#x65E0;&#x6CD5;&#x91CA;&#x653E;&#x9501;</h4>
<div class="outline-text-4" id="text-2-7-2">
<p>
&#x4E92;&#x65A5;&#x9501;&#x3001;&#x6761;&#x4EF6;&#x53D8;&#x91CF;&#x3001;&#x8BFB;&#x5199;&#x9501;&#x3001;POSIX &#x4FE1;&#x53F7;&#x91CF;
</p>
</div>
</div>
</div>
<div id="outline-container-org6e2d03a" class="outline-3">
<h3 id="org6e2d03a"><span class="section-number-3">2.8</span> &#x8FDB;&#x7A0B;&#x3001;&#x7EBF;&#x7A0B;&#x4E0E;&#x5171;&#x4EAB;&#x4FE1;&#x606F;</h3>
<div class="outline-text-3" id="text-2-8">
<p>
&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x4E1C;&#x897F;&#x9650;&#x5236;&#x4EFB;&#x4F55; IPC &#x6280;&#x672F;&#x53EA;&#x9002;&#x7528;&#x4E8E;&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x3002;
</p>
<ol class="org-ol">
<li>&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x5171;&#x4EAB;&#x5B58;&#x7559;&#x4E8E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x4E2D;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x4E0A;&#x7684;&#x67D0;&#x4E9B;&#x4FE1;&#x606F;&#x3002;&#x4E3A;&#x4E86;&#x8BBF;&#x95EE;&#x8FD9;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x90FD;&#x5F97;&#x7A7F;&#x8D8A;&#x5185;&#x6838;&#xFF08;&#x4F8B;&#x5982;
read&#x3001;write&#x3001;lssk &#x7B49;&#xFF09;&#xFF1B;&#x9700;&#x8981;&#x67D0;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x540C;&#x6B65;&#xFF0C;&#x5982;&#x8BB0;&#x5F55;&#x9501;&#x3002;</li>
<li>&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x5171;&#x4EAB;&#x9A7B;&#x7559;&#x4E8E;&#x5185;&#x6838;&#x7684;&#x67D0;&#x4E9B;&#x4FE1;&#x606F;&#xFF0C;&#x8BBF;&#x95EE;&#x5171;&#x4EAB;&#x4FE1;&#x606F;&#x7684;&#x6BCF;&#x6B21;&#x64CD;&#x4F5C;&#x90FD;&#x6D89;&#x53CA;&#x5BF9;&#x5185;&#x6838;&#x7684;&#x4E00;&#x6B21;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002;&#x7BA1;&#x9053;&#x3001;
System V &#x6D88;&#x606F;&#x961F;&#x5217;&#x3001;System V &#x4FE1;&#x53F7;&#x91CF;&#x5747;&#x662F;&#xFF1B;</li>
<li>&#x4E24;&#x4E2A;&#x8FDB;&#x7A0B;&#x6709;&#x4E00;&#x4E2A;&#x53CC;&#x65B9;&#x90FD;&#x80FD;&#x8BBF;&#x95EE;&#x7684;&#x5171;&#x4EAB;&#x5B58;&#x50A8;&#x533A;&#xFF0C;&#x9700;&#x8981;&#x67D0;&#x79CD;&#x5F62;&#x5F0F;&#x7684;&#x540C;&#x6B65;&#xFF08;&#x4FE1;&#x53F7;&#x91CF;&#x7B49;&#xFF09;&#x3002;&#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E00;&#x65E6;&#x8BBE;&#x7F6E;&#x597D;&#x8BE5;&#x5171;&#x4EAB;
&#x5185;&#x5B58;&#x533A;&#xFF0C;&#x5C31;&#x80FD;&#x6839;&#x672C;&#x4E0D;&#x6D89;&#x53CA;&#x5185;&#x6838;&#x800C;&#x8BBF;&#x95EE;&#x5176;&#x4E2D;&#x7684;&#x6570;&#x636E;&#x3002;</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org534e613" class="outline-2">
<h2 id="org534e613"><span class="section-number-2">3</span> &#x8FDB;&#x7A0B; &#x2013; &#x7EBF;&#x7A0B;</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org388b644" class="outline-3">
<h3 id="org388b644"><span class="section-number-3">3.1</span> &#x8BBE;&#x8BA1;&#x7EBF;&#x7A0B;&#x7684;&#x539F;&#x56E0;&#xFF1A;</h3>
<div class="outline-text-3" id="text-3-1">
<ol class="org-ol">
<li>fork &#x7684;&#x5F00;&#x9500;&#x5F88;&#x5927;&#x3002;&#x5185;&#x5B58;&#x6620;&#x5C04;&#x8981;&#x4ECE;&#x7236;&#x8FDB;&#x7A0B;&#x590D;&#x5236;&#x5230;&#x5B50;&#x8FDB;&#x7A0B;&#xFF0C;&#x6240;&#x6709;&#x63CF;&#x8FF0;&#x7B26;&#x8981;&#x5728;&#x5B50;&#x8FDB;&#x7A0B;&#x590D;&#x5236;&#x4E00;&#x4EFD;&#x3002;&#x5C3D;&#x7BA1;&#x5B58;&#x5728;&#x5199;&#x65F6;&#x590D;&#x5236;
(copy-on-write) &#x7684;&#x6280;&#x672F;&#xFF0C;fork &#x7684;&#x5F00;&#x9500;&#x4ECD;&#x7136;&#x5F88;&#x5927;&#x3002;</li>
<li>fork &#x5B50;&#x8FDB;&#x7A0B;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528; IPC &#x5728;&#x7236;&#x5B50;&#x8FDB;&#x7A0B;&#x4E4B;&#x95F4;&#x4F20;&#x9012;&#x4FE1;&#x606F;&#x3002;</li>
</ol>
</div>
</div>
<div id="outline-container-org9f1829b" class="outline-3">
<h3 id="org9f1829b"><span class="section-number-3">3.2</span> &#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x5168;&#x5C40;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</h3>
<div class="outline-text-3" id="text-3-2">
<p>
&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5185;&#x7684;&#x6240;&#x6709;&#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x540C;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x5185;&#x5B58;&#x7A7A;&#x95F4;&#x3002;&#x4F7F;&#x5F97;&#x7EBF;&#x7A0B;&#x95F4;&#x5F88;&#x5BB9;&#x6613;&#x5171;&#x4EAB;&#x4FE1;&#x606F;&#xFF0C;&#x4F46;&#x8FD9;&#x79CD;&#x6613;&#x7528;&#x6027;&#x4E5F;&#x5E26;&#x6765;&#x4E86;&#x540C;&#x6B65;
(synchronization) &#x95EE;&#x9898;&#x3002;
</p>
</div>
</div>
<div id="outline-container-org051b99d" class="outline-3">
<h3 id="org051b99d"><span class="section-number-3">3.3</span> &#x7EBF;&#x7A0B;&#x5171;&#x4EAB;&#x7684;&#x8D44;&#x6E90;</h3>
<div class="outline-text-3" id="text-3-3">
<ul class="org-ul">
<li>&#x5168;&#x5C40;&#x5185;&#x5B58;&#x7A7A;&#x95F4;</li>
<li>&#x8FDB;&#x7A0B;&#x6307;&#x4EE4;</li>
<li>&#x6253;&#x5F00;&#x7684;&#x6587;&#x4EF6;</li>
<li>&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x548C;&#x4FE1;&#x53F7;&#x5904;&#x7F6E;</li>
<li>&#x5F53;&#x524D;&#x5DE5;&#x4F5C;&#x76EE;&#x5F55;</li>
<li>&#x7528;&#x6237; ID &#x548C; &#x7EC4; ID</li>
</ul>
</div>
</div>
<div id="outline-container-org355de89" class="outline-3">
<h3 id="org355de89"><span class="section-number-3">3.4</span> &#x7EBF;&#x7A0B;&#x79C1;&#x6709;&#x8D44;&#x6E90;</h3>
<div class="outline-text-3" id="text-3-4">
<ul class="org-ul">
<li>&#x7EBF;&#x7A0B; ID</li>
<li>&#x5BC4;&#x5B58;&#x5668;&#x96C6;&#x5408;&#xFF0C;&#x5305;&#x62EC;&#x7A0B;&#x5E8F;&#x8BA1;&#x6570;&#x5668;&#x548C;&#x6808;&#x6307;&#x9488;</li>
<li>&#x6808;&#xFF0C;&#x5B58;&#x653E;&#x5C40;&#x90E8;&#x53D8;&#x91CF;&#x548C;&#x8FD4;&#x56DE;&#x5730;&#x5740;</li>
<li>errno</li>
<li>&#x4FE1;&#x53F7;&#x63A9;&#x7801;</li>
<li>&#x4F18;&#x5148;&#x7EA7;</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-orgee89979" class="outline-2">
<h2 id="orgee89979"><span class="section-number-2">4</span> &#x7CFB;&#x7EDF;&#x5F00;&#x9500;</h2>
<div class="outline-text-2" id="text-4">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col class="org-left">

<col class="org-left">
</colgroup>
<tbody>
<tr>
<td class="org-left">&#x6267;&#x884C;&#x4E00;&#x822C;&#x547D;&#x4EE4;</td>
<td class="org-left">1ns = 1/1,000,000,000s</td>
</tr>

<tr>
<td class="org-left">&#x4ECE; L1 &#x7EA7;&#x7F13;&#x5B58;&#x8BFB;</td>
<td class="org-left">0.5ns</td>
</tr>

<tr>
<td class="org-left">&#x5206;&#x652F;&#x8BEF;&#x9884;&#x6D4B;</td>
<td class="org-left">5ns</td>
</tr>

<tr>
<td class="org-left">L2 &#x7EA7;&#x7F13;&#x5B58;&#x8BFB;</td>
<td class="org-left">7ns</td>
</tr>

<tr>
<td class="org-left">&#x52A0;&#x9501;&#x3001;&#x89E3;&#x9501;</td>
<td class="org-left">25ns</td>
</tr>

<tr>
<td class="org-left">&#x4E3B;&#x5B58;&#x4E2D;&#x8BFB;</td>
<td class="org-left">100ns</td>
</tr>

<tr>
<td class="org-left">1Gbps &#x7F51;&#x7EDC;&#x4E2D;&#x53D1; 2k &#x6570;&#x636E;</td>
<td class="org-left">20,000ns</td>
</tr>

<tr>
<td class="org-left">&#x4E3B;&#x5B58;&#x4E2D;&#x8BFB; 1MB &#x5E8F;&#x5217;</td>
<td class="org-left">250,000ns</td>
</tr>

<tr>
<td class="org-left">&#x67E5;&#x627E;&#x4ECE;&#x786C;&#x76D8;&#x4E2D;&#x8BFB;</td>
<td class="org-left">8,000,000ns</td>
</tr>

<tr>
<td class="org-left">&#x786C;&#x76D8;&#x8BFB; 1MB &#x5E8F;&#x5217;</td>
<td class="org-left">20,000,000ns</td>
</tr>

<tr>
<td class="org-left">&#x62A5;&#x6587;&#x4ECE;&#x7F8E;&#x56FD;&#x53D1;&#x5230;&#x6B27;&#x6D32;&#x5E76;&#x8FD4;&#x56DE;</td>
<td class="org-left">150ms = 150,000,000ns</td>
</tr>
</tbody>
</table>
</div>
</div>



<div id="outline-container-orgb7e7124" class="outline-2">
<h2 id="orgb7e7124"><span class="section-number-2">5</span> &#x7EC3;&#x4E60;&#x4EE3;&#x7801;</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgdcdb64c" class="outline-3">
<h3 id="orgdcdb64c"><span class="section-number-3">5.1</span> &#x57FA;&#x672C;&#x51FD;&#x6570;</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/acct.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;pwd.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/resource.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/times.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;mqueue.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> globalNum = <span class="number">522</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echoAllID</span><span class="params">(<span class="keyword">char</span> *processName)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forkTest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vforkTest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exitTest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echoExitStatus</span><span class="params">(<span class="keyword">int</span> status)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">noZombie</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">accountingRecored</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">compt2ulong</span><span class="params">(comp_t comptime)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showAcctTime</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testExecl</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSystem</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testUserloginname</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkTime</span><span class="params">(<span class="keyword">char</span> *processName,</span><br><span class="line">	       <span class="keyword">struct</span> timeval *endtv,</span><br><span class="line">	       <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> *count)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testNice</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showProcessTime</span><span class="params">(clock_t realtime,</span><br><span class="line">		     <span class="keyword">struct</span> tms *tms_start,</span><br><span class="line">		     <span class="keyword">struct</span> tms *tms_end)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCmdTime</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testZombie</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printfRevSignal</span><span class="params">(<span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSignal</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testPipe</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_mq</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanBuf</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">releaseResource</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span><br><span class="line"></span>{</span><br><span class="line">    atexit(releaseResource);</span><br><span class="line">    atexit(cleanBuf);</span><br><span class="line"></span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stdin&apos;s fileno \t %d\n&quot;</span>, fileno(<span class="built_in">stdin</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stdout&apos;s fileno \t %d\n&quot;</span>, fileno(<span class="built_in">stdout</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;stderr&apos;s fileno \t %d\n&quot;</span>, fileno(<span class="built_in">stderr</span>));</span><br><span class="line">    <span class="comment">//echoAllID(argv[0]);</span></span><br><span class="line">    <span class="comment">//forkTest();</span></span><br><span class="line">    <span class="comment">//vforkTest();</span></span><br><span class="line">    <span class="comment">//exitTest();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//noZombie();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//accountingRecored();</span></span><br><span class="line">    <span class="comment">//showAcctTime();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testExecl();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testSystem();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testUserloginname();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testNice();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testCmdTime();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testZombie();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//testSignal();</span></span><br><span class="line"></span><br><span class="line">    test_mq();</span><br><span class="line"></span><br><span class="line">    testPipe();</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echoAllID</span><span class="params">(<span class="keyword">char</span> *processName)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">pid_t</span> ppid;</span><br><span class="line">    <span class="keyword">uid_t</span> uid;</span><br><span class="line">    <span class="keyword">uid_t</span> euid;</span><br><span class="line">    <span class="keyword">gid_t</span> gid;</span><br><span class="line">    <span class="keyword">gid_t</span> egid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Note that none of these functions has an error return.</span></span><br><span class="line">    pid = getpid();</span><br><span class="line">    ppid = getppid();</span><br><span class="line">    uid = getuid();</span><br><span class="line">    euid = geteuid();</span><br><span class="line">    gid = getgid();</span><br><span class="line">    egid = getegid();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The %s process\n&quot;</span></span><br><span class="line">	    <span class="string">&quot;pid = %d, ppid = %d\n&quot;</span></span><br><span class="line">	    <span class="string">&quot;uid = %d, euid = %d\n&quot;</span></span><br><span class="line">	    <span class="string">&quot;gid = %d, egid = %d\n&quot;</span>,</span><br><span class="line">	    processName,</span><br><span class="line">	    pid, ppid,</span><br><span class="line">	    uid, euid,</span><br><span class="line">	    gid, egid);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">forkTest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">99</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[] = <span class="string">&quot;Hello Kyle!\n&quot;</span>;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//The write function is not buffered, its data is written once to </span></span><br><span class="line">    <span class="comment">//standard output before fork.</span></span><br><span class="line">    <span class="keyword">if</span>((<span class="keyword">sizeof</span>(buf) - <span class="number">1</span>) !=</span><br><span class="line">	    write(STDOUT_FILENO, buf, <span class="keyword">sizeof</span>(buf) - <span class="number">1</span>))</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//The standard I/O library is buffered. Standard output is line </span></span><br><span class="line">    <span class="comment">//buffered if it&apos;s connected to a terminal device; otherwise,</span></span><br><span class="line">    <span class="comment">//it&apos;s fully buffered.</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Before fork\n&quot;</span>);</span><br><span class="line">    <span class="comment">//The printf before the fork is called once, but the line remains</span></span><br><span class="line">    <span class="comment">//in buffer when fork is called. This is then copied into the child</span></span><br><span class="line">    <span class="comment">//when the patent&apos;s data space is copied to child. Both parent and</span></span><br><span class="line">    <span class="comment">//the child now have a standard I/O buffer with this line in it. </span></span><br><span class="line">    <span class="comment">//The second printf, right before the exit, just appends its data </span></span><br><span class="line">    <span class="comment">//to the existing buffer. When each process terminates, its copy </span></span><br><span class="line">    <span class="comment">//of the buffer is funally flushed.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid)</span><br><span class="line">    {</span><br><span class="line">	<span class="comment">//changes to variables in a child process do not affect the value</span></span><br><span class="line">	<span class="comment">//of the variables in the parent process.</span></span><br><span class="line">	<span class="comment">//sleep(2);</span></span><br><span class="line">	num = <span class="number">1314</span>;</span><br><span class="line">	globalNum = <span class="number">520</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">	<span class="comment">//Let the child process execute, but there is no guarantee.</span></span><br><span class="line">	sleep(<span class="number">2</span>);</span><br><span class="line">	<span class="comment">//exit(0);</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pid = %d, ppid = %d: num = %d, globalNum = %d\n&quot;</span>,</span><br><span class="line">	    getpid(), getppid(), num, globalNum);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//exit(0);</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vforkTest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">99</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[] = <span class="string">&quot;Hello Kyle!\n&quot;</span>;</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//child will not copy the memory of parent after vfork, just use it</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Before vfork\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = vfork()) &lt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid)</span><br><span class="line">    {</span><br><span class="line">	<span class="comment">//modify parent&apos;s varables</span></span><br><span class="line">	num = <span class="number">1314</span>;</span><br><span class="line">	globalNum = <span class="number">520</span>;</span><br><span class="line">	_exit(<span class="number">0</span>);<span class="comment">//parent will not execute before child call exec or exit</span></span><br><span class="line">	<span class="comment">//_exit will not flush the buffer, but exit will</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pid = %d, ppid = %d: num = %d, globalNum = %d\n&quot;</span>,</span><br><span class="line">	    getpid(), getppid(), num, globalNum);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">echoExitStatus</span><span class="params">(<span class="keyword">int</span> status)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">if</span>(WIFEXITED(status))</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;normal termination, exit status = %d\n&quot;</span>,</span><br><span class="line">		WEXITSTATUS(status));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(WIFSIGNALED(status))</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;abnormal termination, exit status %d.%s\n&quot;</span>,</span><br><span class="line">		WTERMSIG(status),</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> WCOREDUMP</span></span><br><span class="line">    (WCOREDUMP(status)) ? <span class="string">&quot;(a core file was generated)&quot;</span> : <span class="string">&quot;(no core)&quot;</span>);</span><br><span class="line"><span class="preprocessor">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(WIFSTOPPED(status))</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;process stopped by signal %d\n&quot;</span>, WSTOPSIG(status));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(WIFCONTINUED(status))</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;process continued\n&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exitTest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>)</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid)</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(wait(&amp;status) != pid)<span class="comment">//child exit, variable pid in here is parent&apos;s pid variable</span></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	echoExitStatus(status);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>)</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid)</span><br><span class="line">	<span class="built_in">abort</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(wait(&amp;status) != pid)</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	echoExitStatus(status);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">	<span class="comment">//status /= 0;</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(wait(&amp;status) != pid)</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	echoExitStatus(status);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">noZombie</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> status;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>)</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid)</span><br><span class="line">    {</span><br><span class="line">	<span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>)</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>)</span><br><span class="line">	{</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">0</span>);<span class="comment">//first child do nothing and exit</span></span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">//it&apos;s parent is the first child</span></span><br><span class="line">	<span class="comment">//exec the process</span></span><br><span class="line">	sleep(<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;I am the second child. pid=%d,ppid=%d.\n&quot;</span>,</span><br><span class="line">		getpid(), getppid());</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//I am not the parent of the second child</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I am the parent! And I don&apos;t need to see the child.\n&quot;</span>);</span><br><span class="line">    <span class="comment">//if(waitpid(pid, &amp;status, WNOHANG) != pid)//nonblocking</span></span><br><span class="line">    <span class="keyword">if</span>(waitpid(pid, &amp;status, <span class="number">0</span>) != pid)</span><br><span class="line">    {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">	echoExitStatus(status);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8FDB;&#x7A0B;&#x7EDF;&#x8BA1;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="comment">//&#x8FDB;&#x7A0B;&#x7684;&#x5404;&#x7C7B;&#x4FE1;&#x606F;&#x5728;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x65F6;&#x521D;&#x59CB;&#x5316;&#xFF08;&#x7531;&#x5167;&#x6838;&#x4FDD;&#x5B58;&#x5728;&#x8FDB;&#x7A0B;&#x8868;&#x4E2D;&#xFF09;&#xFF0C;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x65F6;&#x5199;</span></span><br><span class="line"><span class="comment">//&#x4E00;&#x4E2A;&#x4F1A;&#x8BA1;&#x8BB0;&#x5F55;&#x3002;</span></span><br><span class="line"><span class="comment">//a&#x3001;&#x6C38;&#x4E0D;&#x7EC8;&#x6B62;&#x7684;&#x8FDB;&#x7A0B;&#x6CA1;&#x6709;&#x4F1A;&#x8BA1;&#x8BB0;&#x5F55;&#xFF1B;</span></span><br><span class="line"><span class="comment">//b&#x3001;&#x53EA;&#x77E5;&#x9053;&#x8FDB;&#x7A0B;&#x7684;&#x8D77;&#x59CB;&#x65F6;&#x95F4;&#xFF0C;&#x4EE5;&#x65E5;&#x5386;&#x65F6;&#x95F4;&#x6765;&#x8BB0;&#xFF0C;&#x7CBE;&#x786E;&#x5230;&#x79D2;&#xFF0C;&#x5728; 1s &#x5185;&#x53EF;&#x80FD;&#x540C;&#x65F6;&#x521B;&#x5EFA;</span></span><br><span class="line"><span class="comment">//&#x4E86;&#x5F88;&#x591A;&#x8FDB;&#x7A0B;&#xFF09;&#x548C;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#xFF08;&#x4EE5; clock ticks &#x6765;&#x8BB0;&#xFF0C;&#x6BCF;&#x79D2;&#x4E2D;&#x6709; 60&#xFF5E;128 ticks&#xFF09;</span></span><br><span class="line"><span class="comment">//&#x4F46;&#x4EC5;&#x77E5;&#x9053;&#x7EC8;&#x6B62;&#x987A;&#x5E8F;&#xFF08;&#x5728;&#x4F1A;&#x8BA1;&#x6587;&#x4EF6;&#x4E2D;&#x4EE5;&#x8FDB;&#x7A0B;&#x7684;&#x7EC8;&#x6B62;&#x987A;&#x5E8F;&#x6765;&#x8BB0;&#x5F55;&#xFF09;&#x65E0;&#x6CD5;&#x5F97;&#x77E5;&#x8FDB;&#x7A0B;&#x7CBE;&#x786E;&#x7684;</span></span><br><span class="line"><span class="comment">//&#x8D77;&#x59CB;&#x65F6;&#x95F4;</span></span><br><span class="line"><span class="comment">//accounting recored &#x5BF9;&#x5E94;&#x7740;&#x8FDB;&#x7A0B;&#x800C;&#x4E0D;&#x662F;&#x7A0B;&#x5E8F;&#xFF1B;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x591A;&#x6B21;&#x8C03;&#x7528; exec &#xFF0C;&#x6700;&#x540E;&#x53EA;</span></span><br><span class="line"><span class="comment">//&#x4F1A;&#x8BB0;&#x5F55;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x7684;&#x547D;&#x4EE4;&#x540D;&#x4F46;&#x8FD0;&#x884C;&#x65F6;&#x95F4;&#x662F;&#x6240;&#x6709; exec &#x8FDB;&#x7A0B;&#x4E4B;&#x548C;&#x3002;fork &#x591A;&#x6B21;&#x4F1A;&#x8BB0;&#x5F55;</span></span><br><span class="line"><span class="comment">//&#x591A;&#x4E2A; accounting recored</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">accountingRecored</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) { <span class="comment">//parent</span></span><br><span class="line">	sleep(<span class="number">25</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) { <span class="comment">//first child</span></span><br><span class="line">	sleep(<span class="number">4</span>);</span><br><span class="line">	<span class="built_in">abort</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) { <span class="comment">//second child</span></span><br><span class="line">	execl(<span class="string">&quot;/bin/dd&quot;</span>, <span class="string">&quot;dd&quot;</span>, <span class="string">&quot;if=/etc/passwd&quot;</span>, <span class="string">&quot;of=/dev/null&quot;</span>,</span><br><span class="line">		<span class="string">&quot;count=1000&quot;</span>, <span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) { <span class="comment">//third child</span></span><br><span class="line">	sleep(<span class="number">8</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    sleep(<span class="number">6</span>); <span class="comment">//forth child</span></span><br><span class="line">    kill(getpid(), SIGKILL);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">6</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="title">compt2ulong</span><span class="params">(comp_t comptime)</span> </span>{</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span>           <span class="built_in">exp</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    val = comptime &amp; <span class="number">0x7fff</span>; <span class="comment">//13 &#x4F4D;&#x5C0F;&#x6570;&#x90E8;&#x5206;</span></span><br><span class="line">    <span class="built_in">exp</span> = (comptime &gt;&gt; <span class="number">13</span>) &amp; <span class="number">7</span>; <span class="comment">//&#x6307;&#x6570;&#x90E8;&#x5206;</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">exp</span>-- &gt; <span class="number">0</span>) {</span><br><span class="line">	val *= <span class="number">8</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showAcctTime</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">struct</span> acct acdata;</span><br><span class="line">    FILE        *fp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x9700;&#x8981;&#x5B89;&#x88C5; acct &#x7A0B;&#x5E8F;&#x3002;&#x4E14;&#x9700;&#x8981; root &#x6743;&#x9650;&#x624D;&#x80FD; accton on/off &#x4EE5;&#x53CA;&#x8BFB;&#x53D6;&#x8BB0;&#x5F55;&#x6587;&#x4EF6;</span></span><br><span class="line">    <span class="keyword">if</span>((fp = fopen(<span class="string">&quot;/var/log/account/pacct&quot;</span>, <span class="string">&quot;r&quot;</span>)) == <span class="literal">NULL</span>) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;can&apos;t open the file\n&quot;</span>);</span><br><span class="line">	<span class="comment">//fflush(STDOUT_FILENO);</span></span><br><span class="line">	<span class="comment">//write(STDOUT_FILENO, &quot;can&apos;t open the file\n&quot;, sizeof(&quot;can&apos;t open the file\n&quot;) -1);</span></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span> == fread(&amp;acdata, <span class="keyword">sizeof</span>(acct), <span class="number">1</span>, fp)) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s etime=%ld io=%ld %c %c %c %c\n&quot;</span>,</span><br><span class="line">		acdata.ac_comm,</span><br><span class="line">		compt2ulong(acdata.ac_etime),</span><br><span class="line">		compt2ulong(acdata.ac_io),</span><br><span class="line">		acdata.ac_flag &amp; AFORK ? <span class="string">&apos;F&apos;</span> : <span class="string">&apos; &apos;</span>,</span><br><span class="line">		acdata.ac_flag &amp; ASU   ? <span class="string">&apos;S&apos;</span> : <span class="string">&apos; &apos;</span>,</span><br><span class="line">		acdata.ac_flag &amp; ACORE ? <span class="string">&apos;C&apos;</span> : <span class="string">&apos; &apos;</span>,</span><br><span class="line">		acdata.ac_flag &amp; AXSIG ? <span class="string">&apos;X&apos;</span> : <span class="string">&apos; &apos;</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testExecl</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> status = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">	<span class="comment">//exec &#x51FD;&#x6570;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x53EA;&#x60F3;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6; execute file</span></span><br><span class="line">	<span class="comment">//argv &#x662F;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;&#x53C2;&#x6570;&#x5217;&#x8868;&#xFF0C;&#x5217;&#x8868;&#x7684;&#x7B2C;&#x4E00;&#x4E2A;&#x53C2;&#x6570;&#x7EA6;&#x5B9A;&#x5199;&#x6210;&#x53EF;&#x6267;&#x884C;&#x6587;&#x4EF6;&#x7684;</span></span><br><span class="line">	<span class="comment">//&#x6587;&#x4EF6;&#x540D;&#x3002;&#x4F46;&#x6D4B;&#x8BD5;&#x53D1;&#x73B0;&#x968F;&#x610F;&#x5199;&#x597D;&#x50CF;&#x5E76;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x5F71;&#x54CD;&#xFF0C;&#x5982;&#x4E0B;&#x6240;&#x793A;</span></span><br><span class="line">	execl(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;qwe&quot;</span>, <span class="string">&quot;-l&quot;</span>, (<span class="keyword">char</span> *)<span class="literal">NULL</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    waitpid(pid, &amp;status, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;status=%d\n&quot;</span>, status);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSystem</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="comment">//system() &#x51FD;&#x6570;&#x7528;&#x4E8E;&#x6267;&#x884C; shell command</span></span><br><span class="line">  <span class="comment">//system &#x4F1A;&#x8C03;&#x7528;fork&#x3001;exec&#x3001;waitpid &#x51FD;&#x6570;&#xFF0C;&#x4E14;&#x8FDB;&#x884C;&#x4E86;&#x5FC5;&#x8981;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x548C;&#x4FE1;&#x53F7;&#x5904;&#x7406;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> status = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((status = system(<span class="string">&quot;date&quot;</span>)) &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;status = %d\n&quot;</span>, status);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((status = system(<span class="string">&quot;nosuchcommand&quot;</span>)) &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;status = %d\n&quot;</span>, status);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((status = system(<span class="string">&quot;who; exit 44&quot;</span>)) &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;status = %d\n&quot;</span>, status);</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testUserloginname</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">char</span> *name = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">char</span> *envname = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">struct</span> passwd *ppasswd;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(-<span class="number">1</span> != setenv(<span class="string">&quot;LOGNAME&quot;</span>, <span class="string">&quot;yym&quot;</span>, <span class="number">1</span>)) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;set the logname to yym\n&quot;</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//getlogin &#x5F97;&#x5230;&#x7528;&#x6237;&#x7684;&#x767B;&#x5F55;&#x540D;&#x3002;&#x4E14;&#x4E00;&#x4E2A; user ID &#x53EF;&#x80FD;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;&#x767B;&#x5F55;&#x540D;&#xFF0C;</span></span><br><span class="line">  <span class="comment">//&#x56E0;&#x4E3A;&#x4ED6;&#x4EEC;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684; shell &#x7B49;&#x539F;&#x56E0;&#x3002;</span></span><br><span class="line">  <span class="comment">//&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x4E2D;&#x7684; LOGNAME &#x7531; login(1) &#x4ECE;&#x767B;&#x5F55;&#x540D;&#x83B7;&#x53D6;&#xFF0C;</span></span><br><span class="line">  <span class="comment">//&#x4F46;&#x662F;&#x7528;&#x6237;&#x53EF;&#x4EE5;&#x66F4;&#x6539;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x53EF;&#x53D6;&#x3002;</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="literal">NULL</span> != (name = getlogin())) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;login name = %s\n&quot;</span>, name);</span><br><span class="line">    envname = getenv(<span class="string">&quot;LOGNAME&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> != envname) {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;envname = %s\n&quot;</span>, envname);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x4ECE;&#x6587;&#x4EF6; passwd &#x4E2D;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x7684;&#x4FE1;&#x606F;</span></span><br><span class="line">    ppasswd = getpwnam(name);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> != ppasswd) {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;name=%s\n&quot;</span>, ppasswd-&gt;pw_name);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;passwd=%s\n&quot;</span>, ppasswd-&gt;pw_passwd);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;user information=%s\n&quot;</span>, ppasswd-&gt;pw_gecos);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;dir=%s\n&quot;</span>, ppasswd-&gt;pw_dir);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;shell=%s\n&quot;</span>, ppasswd-&gt;pw_shell);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;execute getlogin failed\n&quot;</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//&#x6D4B;&#x8BD5;&#x8BFB;&#x53D6;&#x5176;&#x4ED6;&#x7528;&#x6237;&#x7684;&#x4FE1;&#x606F;</span></span><br><span class="line">  <span class="comment">//&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5230;&#xFF0C;&#x4F46;&#x662F;&#x7531;&#x4E8E;&#x5BC6;&#x7801;&#x5E76;&#x4E0D;&#x4FDD;&#x5B58;&#x5728; passwd &#x6587;&#x4EF6;&#x4E2D;</span></span><br><span class="line">  <span class="comment">//&#x6240;&#x4EE5;&#x597D;&#x50CF;&#x6CA1;&#x6709;&#x5B89;&#x5168;&#x9690;&#x60A3;</span></span><br><span class="line">  ppasswd = getpwnam(<span class="string">&quot;boy&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(<span class="literal">NULL</span> != ppasswd) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;name=%s\n&quot;</span>, ppasswd-&gt;pw_name);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;passwd=%s\n&quot;</span>, ppasswd-&gt;pw_passwd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;user information=%s\n&quot;</span>, ppasswd-&gt;pw_gecos);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;dir=%s\n&quot;</span>, ppasswd-&gt;pw_dir);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;shell=%s\n&quot;</span>, ppasswd-&gt;pw_shell);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkTime</span><span class="params">(<span class="keyword">char</span> *processName,</span><br><span class="line">	       <span class="keyword">struct</span> timeval *endtv,</span><br><span class="line">	       <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> *count)</span> </span>{</span><br><span class="line">  <span class="keyword">struct</span> timeval tv;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//&#x83B7;&#x53D6;&#x65F6;&#x95F4;&#x3002;&#x7ED3;&#x6784;&#x4F53; timeval &#x4E2D;&#x6709;&#x4E24;&#x4E2A;&#x6210;&#x5458;&#x53D8;&#x91CF; tv_sec&#x3001;tv_usec</span></span><br><span class="line">  gettimeofday(&amp;tv, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="keyword">if</span>(tv.tv_sec &gt;= endtv-&gt;tv_sec &amp;&amp; tv.tv_usec &gt;= endtv-&gt;tv_usec) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%10s count %lld\n&quot;</span>, processName, *count);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testNice</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">pid_t</span> pid = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">char</span> *processname;</span><br><span class="line">  <span class="keyword">struct</span> timeval endtv;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> priority = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int</span> niceval = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">  gettimeofday(&amp;endtv, <span class="literal">NULL</span>);</span><br><span class="line">  endtv.tv_sec += <span class="number">10</span>; <span class="comment">//&#x8BA9;&#x8FDB;&#x7A0B;&#x8FD0;&#x884C; 10s</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">    processname = <span class="string">&quot;child&quot;</span>;</span><br><span class="line">    <span class="comment">//&#x83B7;&#x53D6;&#x8FDB;&#x7A0B;&#x7684;&#x8C03;&#x5EA6;&#x4F18;&#x5148;&#x7EA7;</span></span><br><span class="line">    priority = getpriority(PRIO_PROCESS, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;child process priority = %d\n&quot;</span>, priority);</span><br><span class="line">    <span class="comment">//&#x8FDB;&#x7A0B;&#x9ED8;&#x8BA4;&#x7684; nice &#x503C;</span></span><br><span class="line">    niceval = sysconf(_SC_NZERO);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;process default nice value = %d,&quot;</span></span><br><span class="line">	   <span class="string">&quot;child nice value = %d\n&quot;</span>,</span><br><span class="line">	   niceval, nice(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//nice &#x503C;&#x7684;&#x8303;&#x56F4; -20&#xFF5E;19&#xFF0C;nice &#x53C2;&#x6570;&#x4E3A;&#x589E;&#x52A0;&#x7684;&#x503C;&#x3002;&#x4E14;&#x8FD4;&#x56DE;&#x503C;&#x4E3A;&#x65B0;&#x7684; nice &#x503C;&#x3002;</span></span><br><span class="line">    <span class="comment">//&#x7531;&#x4E8E;&#x6709;&#x53EF;&#x80FD;&#x4E3A; -1&#xFF0C;&#x6240;&#x4EE5;&#x9700;&#x8981;&#x5148;&#x5C06; errno &#x6E05;&#x96F6;&#xFF0C;&#x7136;&#x540E;&#x5F53; nice &#x8FD4;&#x56DE; -1 &#x4E14;</span></span><br><span class="line">    <span class="comment">//errno &#x4E0D;&#x4E3A; 0 &#x65F6;&#x624D;&#x8868;&#x793A;&#x8C03;&#x6574;&#x5931;&#x8D25;&#x3002;</span></span><br><span class="line">    errno = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == nice(<span class="number">20</span>) &amp;&amp; <span class="number">0</span> != errno) {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;child faild to change the nice value\n&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;child new nice val is %d\n&quot;</span>, nice(<span class="number">0</span>));</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    processname = <span class="string">&quot;parent&quot;</span>;</span><br><span class="line"></span><br><span class="line">    priority = getpriority(PRIO_PROCESS, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;parent process priority = %d\n&quot;</span>, priority);</span><br><span class="line">    niceval = sysconf(_SC_NZERO);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;parent process default nice value = %d,&quot;</span>, nice(<span class="number">0</span>));</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>) {</span><br><span class="line">    ++count;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> == count) {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%10.10s count warp\n&quot;</span>, processname);</span><br><span class="line">    }</span><br><span class="line">    checkTime(processname, &amp;endtv, &amp;count);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showProcessTime</span><span class="params">(clock_t realtime,</span><br><span class="line">		     <span class="keyword">struct</span> tms *tms_start,</span><br><span class="line">		     <span class="keyword">struct</span> tms *tms_end)</span> </span>{</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">long</span> clktck = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="number">0</span> == clktck) {</span><br><span class="line">    clktck = sysconf(_SC_CLK_TCK);</span><br><span class="line">    <span class="keyword">if</span>(clktck &lt;= <span class="number">0</span>) {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;get the clock tick failed\n&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;the clock tick is %d\n&quot;</span>, clktck);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; real:  %7.2f\n&quot;</span>, realtime / (<span class="keyword">double</span>)clktck);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; user:  %7.2f\n&quot;</span>, (tms_end-&gt;tms_utime - tms_start-&gt;tms_utime) / (<span class="keyword">double</span>)clktck);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; sys:  %7.2f\n&quot;</span>, (tms_end-&gt;tms_stime - tms_start-&gt;tms_stime) / (<span class="keyword">double</span>)clktck);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; cuser:  %7.2f\n&quot;</span>, (tms_end-&gt;tms_cutime - tms_start-&gt;tms_cutime) / (<span class="keyword">double</span>)clktck);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; csys:  %7.2f\n&quot;</span>, (tms_end-&gt;tms_cstime - tms_start-&gt;tms_cstime) / (<span class="keyword">double</span>)clktck);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; csysstart:  %7.2f\n&quot;</span>, (tms_start-&gt;tms_cstime) / (<span class="keyword">double</span>)clktck);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; csysend:  %7.2f\n&quot;</span>, (tms_end-&gt;tms_cstime) / (<span class="keyword">double</span>)clktck);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCmdTime</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">clock_t</span> walltimestart;</span><br><span class="line">  <span class="keyword">clock_t</span> walltimeend;</span><br><span class="line">  <span class="keyword">struct</span> tms tms_start;</span><br><span class="line">  <span class="keyword">struct</span> tms tms_end;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(-<span class="number">1</span> == (walltimestart = time(&amp;tms_start))) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; wallstart:  %7.2f\n&quot;</span>, (walltimestart) / (<span class="keyword">double</span>)<span class="number">100</span>);</span><br><span class="line">  <span class="keyword">if</span>(system(<span class="string">&quot;dd if=/etc/passwd of=/dev/null count=10000&quot;</span>) &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(-<span class="number">1</span> == (walltimeend = time(&amp;tms_end))) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot; wallend:  %7.2f\n&quot;</span>, (walltimeend) / (<span class="keyword">double</span>)<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">  showProcessTime(walltimeend - walltimestart, &amp;tms_start, &amp;tms_end);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testZombie</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">pid_t</span> pid = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  sleep(<span class="number">4</span>);</span><br><span class="line">  system(<span class="string">&quot;ps -o pid,ppid,state,tty,command&quot;</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x89E3;&#x91CA;&#x5668;&#x6587;&#x4EF6;--&#x5C06;&#x53C2;&#x6570;&#x91CD;&#x65B0;&#x89E3;&#x91CA;&#x6210;&#x4E86;&#x65B0;&#x7684; shell &#x8BED;&#x53E5;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printfRevSignal</span><span class="params">(<span class="keyword">int</span> signo)</span> </span>{</span><br><span class="line">  <span class="keyword">if</span>(SIGRTMIN == signo) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Received SIGUSER1\n&quot;</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(SIGRTMIN+<span class="number">1</span> == signo) {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Received SIGUSER2\n&quot;</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Received signal %d\n&quot;</span>, signo);</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSignal</span><span class="params">()</span> </span>{</span><br><span class="line">  <span class="keyword">void</span> (*pSig)(<span class="keyword">int</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//signal &#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x8981;&#x8BBE;&#x7F6E;&#x7684;&#x4FE1;&#x53F7;&#x539F;&#x6765;&#x7684;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;</span></span><br><span class="line">  <span class="keyword">if</span>(SIG_ERR == (pSig = signal(SIGRTMIN, printfRevSignal))) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;previous signal pointer1 = %p\n&quot;</span>, pSig);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">if</span>(SIG_ERR == (pSig = signal(SIGRTMIN+<span class="number">1</span>, printfRevSignal))) {</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span> {</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;previous signal pointer = %p\n&quot;</span>, pSig);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Linux &#x4E0A;&#x4E5F;&#x5B9A;&#x4E49;&#x4E86;&#x4FE1;&#x53F7; SIGCLD &#x4FE1;&#x53F7;&#xFF1B;&#x5176;&#x6709;&#x53EF;&#x80FD;&#x5728;&#x5176;&#x4ED6;&#x7CFB;&#x7EDF;&#x4E0A;&#x5BFC;&#x81F4;&#x8FDB;&#x884C;&#x53CD;&#x590D;&#x8C03;&#x7528;</span></span><br><span class="line">  <span class="comment">//&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x800C;&#x5BFC;&#x81F4;&#x5806;&#x6808;&#x6EA2;&#x51FA;&#xFF0C;&#x8FDB;&#x7A0B;&#x7EC8;&#x6B62;&#x3002;</span></span><br><span class="line">  <span class="comment">//if(SIG_ERR == (pSig = signal(SIGCLD, printfRevSignal)));</span></span><br><span class="line">  <span class="comment">//&#x53EF;&#x4EE5;&#x5229;&#x7528; sigaction &#x51FD;&#x6570;&#x8BBE;&#x7F6E; SA_NOCLDWAIT &#x6765;&#x907F;&#x514D;&#x4EA7;&#x751F;&#x50F5;&#x6B7B;&#x8FDB;&#x7A0B;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>) {</span><br><span class="line">    pause();</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x4E0D;&#x53EF;&#x9760;&#x4FE1;&#x53F7;&#xFF1A;&#xFF08;&#x6700;&#x4E3B;&#x8981;&#x7684;&#x7279;&#x70B9;&#xFF1A;&#x4FE1;&#x53F7;&#x53EF;&#x80FD;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x4EA7;&#x751F;&#xFF09;</span></span><br><span class="line"><span class="comment">//1. &#x4FE1;&#x53F7;&#x53EF;&#x80FD;&#x4F1A;&#x4E22;&#x5931;&#xFF1B;&#x4FE1;&#x53F7;&#x4EA7;&#x751F;&#x540E;&#x8FDB;&#x7A0B;&#x5374;&#x65E0;&#x6CD5;&#x5F97;&#x5230;&#x901A;&#x77E5;</span></span><br><span class="line"><span class="comment">//2. &#x4E0D;&#x5177;&#x5907;&#x963B;&#x585E;&#x4FE1;&#x53F7;&#x7684;&#x80FD;&#x529B;&#xFF1B;&#x8FDB;&#x7A0B;&#x53EA;&#x80FD;&#x6355;&#x6349;&#x6216;&#x8005;&#x5FFD;&#x7565;</span></span><br><span class="line"><span class="comment">//3. &#x4FE1;&#x53F7;&#x5904;&#x7406;&#x53EA;&#x751F;&#x6548;&#x4E00;&#x6B21;&#xFF0C;&#x7136;&#x540E;&#x6062;&#x590D;&#x7CFB;&#x7EDF;&#x9ED8;&#x8BA4;</span></span><br><span class="line"><span class="comment">//4. &#x7CFB;&#x7EDF;&#x6267;&#x884C;&#x6162;&#x901F;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x82E5;&#x63A5;&#x6536;&#x5230;&#x4E2D;&#x65AD;&#x4FE1;&#x53F7;&#xFF0C;&#x5219;&#x7EC8;&#x6B62;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x51FA;&#x9519;&#x3002;</span></span><br><span class="line"><span class="comment">//   UNIX &#x7CFB;&#x7EDF;&#x540E;&#x6765;&#x652F;&#x6301;&#x81EA;&#x52A8;&#x91CD;&#x542F;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF1A;ioctl,read,readv,write,writev,wait</span></span><br><span class="line"><span class="comment">//   &#x5426;&#x5219;&#x7528;&#x6237;&#x5C31;&#x5FC5;&#x987B;&#x6BCF;&#x6B21;&#x8FDB;&#x884C;&#x51FA;&#x9519;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x662F;&#x4E2D;&#x65AD;&#x5219;&#x91CD;&#x542F;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;</span></span><br><span class="line"><span class="comment">//5. &#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x4E2D;&#x8C03;&#x7528;&#x7684;&#x51FD;&#x6570;&#x8981;&#x662F;&#x53EF;&#x91CD;&#x5165;&#x7684;&#xFF0C;&#x5373;&#x5F02;&#x6B65;&#x4FE1;&#x53F7;&#x5B89;&#x5168;&#x7684;</span></span><br><span class="line"><span class="comment">//   &#x4E0D;&#x53EF;&#x91CD;&#x5165;&#x7684;&#x51FD;&#x6570;&#xFF1A;</span></span><br><span class="line"><span class="comment">//                   a) &#x4F7F;&#x7528;&#x9759;&#x6001;&#x6570;&#x636E;&#x7ED3;&#x6784;&#xFF1B;</span></span><br><span class="line"><span class="comment">//                   b) &#x8C03;&#x7528; malloc,free &#xFF1B;&#x4F1A;&#x4F7F;&#x7528;&#x9759;&#x6001;&#x53D8;&#x91CF;&#xFF08;&#x94FE;&#x8868;&#xFF09;&#x6765;&#x7EF4;&#x62A4;&#x5185;&#x5B58;&#x4FE1;&#x606F;</span></span><br><span class="line"><span class="comment">//                   c) &#x8C03;&#x7528;&#x6807;&#x51C6; I/O &#x51FD;&#x6570;&#x3002;&#x6807;&#x51C6; I/O &#x51FD;&#x6570;&#x5927;&#x90FD;&#x4F7F;&#x7528;&#x4E86;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;</span></span><br><span class="line"><span class="comment">//6. &#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x53EA;&#x6709;&#x4E00;&#x4E2A; errno &#xFF0C;&#x800C;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#x53EF;&#x80FD;&#x66F4;&#x6539; errno &#xFF1B;</span></span><br><span class="line"><span class="comment">//   &#x6240;&#x4EE5;&#x5E94;&#x5F53;&#x5728;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#x524D;&#x4FDD;&#x5B58; errno&#xFF0C;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x540E;&#x8FD4;&#x56DE; errno&#x3002;</span></span><br><span class="line"><span class="comment">//7. &#x66F4;&#x65B0;&#x5168;&#x5C40;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x65F6;&#xFF0C;&#x963B;&#x585E;&#x53EF;&#x80FD;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x7684;&#x4FE1;&#x53F7;</span></span><br><span class="line"><span class="comment">//8. alarm &#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5B9A;&#x65F6;&#x5668;&#xFF0C;&#x5728;&#x5B9A;&#x65F6;&#x65F6;&#x95F4;&#x5230;&#x540E;&#x4EA7;&#x751F;&#x4E00;&#x4E2A; SIGALRM &#x4FE1;&#x53F7;&#x3002;</span></span><br><span class="line"><span class="comment">//   &#x6BCF;&#x4E2A;&#x8FDB;&#x7A0B;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x95F9;&#x949F;&#x65F6;&#x95F4;&#x3002;&#x65B0;&#x8BBE;&#x7F6E;&#x7684;&#x95F9;&#x949F;&#x65F6;&#x95F4;&#x4F1A;&#x8986;&#x76D6;&#x539F;&#x6765;&#x7684;&#x3002;</span></span><br><span class="line"><span class="comment">//   &#x5728; SIGALRM &#x7684;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x8981;&#x68C0;&#x67E5;&#x4E4B;&#x524D;&#x7684;&#x65F6;&#x95F4;&#xFF0C;&#x4E14;&#x8981;&#x4FDD;&#x5B58;&#x8FD4;&#x56DE;&#x4E4B;&#x524D;&#x7684;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;</span></span><br><span class="line"><span class="comment">//9. &#x8BBE;&#x7F6E; SIGALRM &#x4FE1;&#x53F7;&#x5904;&#x7406;&#x51FD;&#x6570;&#x8981;&#x5728;&#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x5668;&#x4E4B;&#x524D;&#xFF0C;&#x5426;&#x5219;&#x6709;&#x53EF;&#x80FD;&#x5B9A;&#x65F6;&#x5668;&#x65F6;&#x95F4;&#x5230;&#xFF0C;&#x7136;&#x540E;</span></span><br><span class="line"><span class="comment">//   &#x5C31;&#x4F1A;&#x6267;&#x884C;&#x9ED8;&#x8BA4;&#x5904;&#x7406;&#xFF0C;&#x7EC8;&#x6B62;&#x8FDB;&#x7A0B;&#x3002;</span></span><br><span class="line"><span class="comment">//10. &#x8BBE;&#x7F6E;&#x5B9A;&#x65F6;&#x5668;&#x540E;&#x63A5;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7ADE;&#x4E89;&#x6761;&#x4EF6;&#xFF08;&#x5047;&#x5982;&#x60F3;&#x8981;&#x5229;&#x7528;&#x8BE5;&#x5B9A;&#x65F6;&#x5668;&#x6765;&#x7ED3;&#x675F;&#x4E4B;&#x540E;</span></span><br><span class="line"><span class="comment">//    &#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF09;&#x3002;&#x5F53;&#x7CFB;&#x7EDF;&#x7684;&#x8D1F;&#x8F7D;&#x5F88;&#x91CD;&#x65F6;&#xFF0C;&#x53EF;&#x80FD;&#x5B9A;&#x65F6;&#x95F4;&#x5230;&#x540E;&#xFF0C;&#x5904;&#x7406;&#x5B8C;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#x540E;&#xFF0C;</span></span><br><span class="line"><span class="comment">//    &#x4ECD;&#x7136;&#x6CA1;&#x6709;&#x8FD0;&#x884C;&#x4E4B;&#x540E;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#x3002; race condition</span></span><br><span class="line"><span class="comment">//    &#x4F7F;&#x7528; setjmp,longjmp &#x6765;&#x89E3;&#x51B3;&#x65F6;&#xFF0C;&#x5982;&#x679C; SIGALRM &#x4E2D;&#x65AD;&#x4E86;&#x5176;&#x4ED6;&#x7684;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x90A3;&#x4E48;</span></span><br><span class="line"><span class="comment">//    longjmp &#x4F1A;&#x63D0;&#x65E9;&#x7ED3;&#x675F;&#x5176;&#x4ED6;&#x7684;&#x4E2D;&#x65AD;&#x5904;&#x7406;&#x51FD;&#x6570;&#xFF0C;&#x800C;&#x5BFC;&#x81F4;&#x5F02;&#x5E38;&#x3002;</span></span><br><span class="line"><span class="comment">//11. &#x5728;&#x4FE1;&#x53F7;&#x4EA7;&#x751F;(generation)&#x548C;&#x9012;&#x9001;(delivery)&#x4E4B;&#x95F4;&#x7684;&#x65F6;&#x95F4;&#x95F4;&#x9694;&#x5185;&#xFF0C;&#x79F0;&#x4FE1;&#x53F7;&#x662F;&#x672A;&#x51B3;&#x7684;(pending)&#xFF1B;</span></span><br><span class="line"><span class="comment">//&#x5F53;&#x8FDB;&#x7A0B;&#x5BF9;&#x4FE1;&#x53F7;&#x91C7;&#x53D6;&#x67D0;&#x79CD;&#x52A8;&#x4F5C;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x79F0;&#x5411;&#x8FDB;&#x7A0B;&#x9012;&#x9001;&#x4E86;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x3002;</span></span><br><span class="line"><span class="comment">//&#x8C03;&#x7528; sigprocmask &#x963B;&#x585E;&#x67D0;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#xFF0C;&#x4E4B;&#x540E;&#x4EA7;&#x751F;&#x8BE5;&#x4FE1;&#x53F7;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x4FE1;&#x53F7;&#x662F;&#x963B;&#x585E;&#x4E0D;&#x80FD;&#x4F20;&#x9012;&#x7684;&#xFF0C;</span></span><br><span class="line"><span class="comment">//&#x56E0;&#x800C;&#x4E5F;&#x4E00;&#x5B9A;&#x662F;&#x672A;&#x51B3;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x51FD;&#x6570; sigpending &#x6765;&#x83B7;&#x53D6;&#x6240;&#x6709;&#x672A;&#x51B3;&#x7684;&#x4FE1;&#x53F7;&#x3002;</span></span><br><span class="line"><span class="comment">//12. &#x4F7F;&#x7528; sigaction &#x6765;&#x68C0;&#x67E5;&#x3001;&#x4FEE;&#x6539;&#x6307;&#x5B9A;&#x4FE1;&#x53F7;&#x7684;&#x5904;&#x7406;&#x52A8;&#x4F5C;&#x3002;&#x53D6;&#x4EE3; signal &#x51FD;&#x6570;&#x3002;</span></span><br><span class="line"><span class="comment">//    &#x66F4;&#x6539;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x7684;&#x5904;&#x7406;&#x52A8;&#x4F5C;&#x540E;&#x4F1A;&#x4E00;&#x76F4;&#x751F;&#x6548;&#xFF0C;&#x76F4;&#x5230;&#x4E0B;&#x4E00;&#x6B21;&#x663E;&#x793A;&#x8C03;&#x7528;&#x8BE5;&#x51FD;&#x6570;&#x66F4;&#x6539;&#x3002;</span></span><br><span class="line"><span class="comment">//    &#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x5F15;&#x53D1;&#x4E86;&#x5176;&#x5904;&#x7406;&#x52A8;&#x4F5C;&#xFF0C;&#x7136;&#x540E;&#x8BE5;&#x4FE1;&#x53F7;&#x4F1A;&#x88AB;&#x963B;&#x585E;&#x76F4;&#x5230;&#x5904;&#x7406;&#x5B8C;&#x6210;&#x8FD4;&#x56DE;&#x3002;&#x9664;&#x975E;&#x8BBE;&#x7F6E;&#x4E86;</span></span><br><span class="line"><span class="comment">//    saflag &#x7684; SA_NODEFER &#x6807;&#x5FD7;</span></span><br><span class="line"><span class="comment">//    sa_handler &#x548C; sa_sigaction &#x53EF;&#x80FD;&#x4F7F;&#x7528;&#x540C;&#x4E00;&#x5B58;&#x50A8;&#x533A;&#xFF0C;&#x7528;&#x6237;&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;</span></span><br><span class="line"><span class="comment">//    &#x9ED8;&#x8BA4;&#x4E0D;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x88AB;&#x4E2D;&#x65AD;&#x7684;&#x7CFB;&#x7EDF;&#x8C03;&#x7528;&#xFF0C;&#x9664;&#x975E;&#x8BBE;&#x7F6E;&#x4E86; SA_RESTART &#x6807;&#x5FD7;</span></span><br><span class="line"><span class="comment">//13. &#x8C03;&#x7528; sigprocmask &#x6062;&#x590D;&#x4E4B;&#x524D;&#x7684;&#x8FDB;&#x7A0B;&#x5C4F;&#x853D;&#x4FE1;&#x53F7;&#x96C6;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x4EFB;&#x4F55;&#x672A;&#x51B3;&#x7684;&#x3001;&#x4E0D;&#x518D;&#x963B;&#x585E;&#x7684;&#x4FE1;&#x53F7;&#xFF0C;</span></span><br><span class="line"><span class="comment">//    &#x5219;&#x5728; sigprocmask &#x8FD4;&#x56DE;&#x524D;&#xFF0C;&#x81F3;&#x5C11;&#x5C06;&#x5176;&#x4E2D;&#x4E4B;&#x4E00;&#x9012;&#x9001;&#x7ED9;&#x8FDB;&#x7A0B;&#x3002;</span></span><br><span class="line"><span class="comment">//    &#x5728;&#x7EBF;&#x7A0B;&#x4E2D;&#x4F7F;&#x7528;&#x51FD;&#x6570; pthread_sigmask &#x6765;&#x8BBE;&#x7F6E;&#x3002;</span></span><br><span class="line"><span class="comment">//    &#x6BCF;&#x4E2A;&#x7EBF;&#x7A0B;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x5C4F;&#x853D;&#x5B57;(signal mask)&#xFF0C;&#x89C4;&#x5B9A;&#x4E86;&#x5F53;&#x524D;&#x8981;&#x963B;&#x585E;&#x9001;&#x5230;&#x8FDB;&#x7A0B;&#x7684;&#x4FE1;&#x53F7;&#x96C6;&#x3002;</span></span><br><span class="line"><span class="comment">//    &#x5185;&#x6838;&#x5728;&#x9012;&#x9001;&#x4E00;&#x4E2A;&#x539F;&#x6765;&#x88AB;&#x963B;&#x585E;&#x7684;&#x4FE1;&#x53F7;&#x7ED9;&#x8FDB;&#x7A0B;&#x65F6;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5728;&#x4EA7;&#x751F;&#x4FE1;&#x53F7;&#x65F6;&#xFF0C;&#x624D;&#x51B3;&#x5B9A;&#x4FE1;&#x53F7;&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#xFF0C;</span></span><br><span class="line"><span class="comment">//    &#x4E8E;&#x662F;&#xFF0C;&#x8FDB;&#x7A0B;&#x5728;&#x4FE1;&#x53F7;&#x9012;&#x9001;&#x7ED9;&#x4ED6;&#x4E4B;&#x524D;&#x4ECD;&#x53EF;&#x4EE5;&#x6539;&#x53D8;&#x5BF9;&#x8BE5;&#x4FE1;&#x53F7;&#x7684;&#x52A8;&#x4F5C;&#x3002;</span></span><br><span class="line"><span class="comment">//14. &#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF1A;&#x5148;&#x6062;&#x590D;&#x4FE1;&#x53F7;&#x5C4F;&#x853D;&#x5B57;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x8FDB;&#x7A0B;&#x4F11;&#x7720; -- sigsuspend&#xFF1B;</span></span><br><span class="line"><span class="comment">//    &#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x65F6;&#x4FE1;&#x53F7;&#x5C4F;&#x853D;&#x5B57;&#x8BBE;&#x7F6E;&#x6210;&#x8C03;&#x7528;&#x4E4B;&#x524D;&#x7684;&#x503C;</span></span><br><span class="line"><span class="comment">//    &#x907F;&#x514D;&#x4FE1;&#x53F7;&#x5728;&#x6062;&#x590D;&#x5C4F;&#x853D;&#x5B57;&#x548C;&#x4F7F;&#x8FDB;&#x7A0B;&#x4F11;&#x7720;&#x4E4B;&#x95F4;&#x4E22;&#x5931;&#x3002;</span></span><br><span class="line"><span class="comment">//    a) &#x4FDD;&#x62A4;&#x4EE3;&#x7801;&#x4E34;&#x754C;&#x533A;&#xFF0C;&#x4F7F;&#x5176;&#x4E0D;&#x88AB;&#x7279;&#x5B9A;&#x7684;&#x4FE1;&#x53F7;&#x4E2D;&#x65AD;</span></span><br><span class="line"><span class="comment">//    b) &#x7B49;&#x5F85;&#x4E00;&#x4E2A;&#x4FE1;&#x53F7;&#x5904;&#x7406;&#x7A0B;&#x5E8F;&#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testPipe</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> fd[<span class="number">2</span>] = {<span class="number">0</span>};</span><br><span class="line">    <span class="keyword">size_t</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> line[<span class="number">4096</span>];</span><br><span class="line">    <span class="keyword">char</span> *pline = <span class="literal">NULL</span>;</span><br><span class="line">    FILE *fp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">NULL</span> == (fp = fopen(<span class="string">&quot;/etc/passwd&quot;</span>, <span class="string">&quot;r&quot;</span>))) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(pipe(fd) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) {</span><br><span class="line">	close(fd[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(fgets(line, <span class="number">4094</span>, fp) != <span class="literal">NULL</span>) {</span><br><span class="line">	    pline = line;</span><br><span class="line">	    n = <span class="built_in">strlen</span>(pline);</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;n=%d\n&quot;</span>, n);</span><br><span class="line">	    <span class="keyword">if</span>(write(fd[<span class="number">1</span>], line, n) != n) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(ferror(fp)) {</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	close(fd[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(waitpid(pid, <span class="literal">NULL</span>, <span class="number">0</span>) &lt; <span class="number">0</span>) {</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line"></span><br><span class="line">	close(fd[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(fd[<span class="number">0</span>] != STDIN_FILENO) {</span><br><span class="line">	    <span class="comment">//let STDIN_FILENO be the read side of the pipe</span></span><br><span class="line">	    <span class="keyword">if</span>(dup2(fd[<span class="number">0</span>], STDIN_FILENO) != STDIN_FILENO) {</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line">	    close(fd[<span class="number">0</span>]);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(execl(<span class="string">&quot;/bin/more&quot;</span>, <span class="string">&quot;more&quot;</span>, (<span class="keyword">char</span> *)<span class="literal">NULL</span>) &lt; <span class="number">0</span>) {</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;%s:%d\n&quot;</span>, __func__, __LINE__);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//popen()</span></span><br><span class="line"><span class="comment">//pclose()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//mkfifo()</span></span><br><span class="line"><span class="comment">//mkfifoat()</span></span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA; fifo &#x4E4B;&#x540E;&#x8981;&#x4F7F;&#x7528; open &#x51FD;&#x6570;&#x6253;&#x5F00;&#xFF0C;&#x4E14;&#x53EA;&#x8BFB;&#x6253;&#x5F00;&#x4F1A;&#x963B;&#x585E;&#x5230;&#x67D0;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E3A;&#x5199;&#x800C;&#x6253;&#x5F00;&#x8BE5; fifo ,</span></span><br><span class="line"><span class="comment">//&#x53CD;&#x4E4B;&#x4EA6;&#x7136;&#x3002;&#x4E00;&#x4E2A;&#x7ED9;&#x5B9A;&#x7684; fifo &#x6709;&#x591A;&#x4E2A;&#x5199;&#x8FDB;&#x7A0B;&#x662F;&#x5F88;&#x5E38;&#x89C1;&#x7684;&#xFF0C;&#x56E0;&#x6B64;&#x5E94;&#x8BE5;&#x786E;&#x4FDD;&#x6BCF;&#x6B21;&#x5199;&#x90FD;&#x662F;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#xFF0C;</span></span><br><span class="line"><span class="comment">//&#x5F53;&#x5199;&#x7684;&#x6570;&#x636E;&#x5927;&#x5C0F;&#x4E0D;&#x5927;&#x4E8E; PIPE_BUF &#x65F6;&#x53EF;&#x4EE5;&#x786E;&#x4FDD;&#x662F;&#x539F;&#x5B50;&#x64CD;&#x4F5C;&#x3002;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//msgget()</span></span><br><span class="line"><span class="comment">//msgctl()</span></span><br><span class="line"><span class="comment">//msgsnd()</span></span><br><span class="line"><span class="comment">//msgrev()</span></span><br><span class="line"><span class="comment">//mq_open</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_mq</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">mqd_t</span> mqID;</span><br><span class="line">    <span class="keyword">struct</span> mq_attr attr;</span><br><span class="line">    <span class="keyword">int</span> rc = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    mqID = mq_open(<span class="string">&quot;/msg_default&quot;</span>,  O_CREAT | O_EXCL,</span><br><span class="line">		    S_IRUSR | S_IWUSR, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == mqID) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d %d %d %d\n&quot;</span>, EACCES, EEXIST, EINVAL,</span><br><span class="line">		EMFILE, ENAMETOOLONG, ENFILE);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;create msg queue failed. errno = %d\n&quot;</span>, errno);</span><br><span class="line">	<span class="keyword">if</span>(EINVAL == errno) {</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;wrong\n&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    rc = mq_getattr(mqID, &amp;attr);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;get attr failed\n&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Maxmum message on queue: %ld\n&quot;</span>, attr.mq_maxmsg);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Maxmum message size: %ld\n&quot;</span>, attr.mq_msgsize);</span><br><span class="line"></span><br><span class="line">    rc = mq_unlink(<span class="string">&quot;/msg_default&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//sem_init &#x533F;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line"><span class="comment">//sem_destory &#x9500;&#x6BC1;&#x533F;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line"><span class="comment">//sem_open &#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line"><span class="comment">//sem_close &#x5173;&#x95ED;&#x547D;&#x4EE4;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line"><span class="comment">//sem_unlink &#x9500;&#x6BC1;&#x547D;&#x540D;&#x4FE1;&#x53F7;&#x91CF;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//shm_open</span></span><br><span class="line"><span class="comment">//mmap</span></span><br><span class="line"><span class="comment">//shm_unlink</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanBuf</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pid:%d,clean all buf. Invoke by atexit\n&quot;</span>, getpid());</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">releaseResource</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pid:%d,release all resource. Invoke by atexit\n&quot;</span>, getpid());</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-orgdb9d585" class="outline-3">
<h3 id="orgdb9d585"><span class="section-number-3">5.2</span> IPC</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;mqueue.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> FIFOPATH <span class="string">&quot;/home/kyle/APUE/test/fifo&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fifotest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">opentest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writetest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mqtest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shmtest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pthreadtest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unlockInAtexit</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmaptest</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fcntltest</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> {</span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line">    <span class="keyword">pthread_cond_t</span> cond;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">} var = {PTHREAD_MUTEX_INITIALIZER, PTHREAD_COND_INITIALIZER};</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">//writetest();</span></span><br><span class="line">    <span class="comment">//fifotest();</span></span><br><span class="line">    <span class="comment">//opentest();</span></span><br><span class="line">    <span class="comment">//mqtest();</span></span><br><span class="line">    <span class="comment">//shmtest();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//pthreadtest();</span></span><br><span class="line">    <span class="comment">//unlockInAtexit();</span></span><br><span class="line">    <span class="comment">//mmaptest();</span></span><br><span class="line"></span><br><span class="line">    fcntltest();</span><br><span class="line">    <span class="comment">//sleep(10);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x6253;&#x5F00;&#x53EA;&#x8BFB;&#x7684; fifo &#x65F6;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x5230;&#x67D0;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E3A;&#x5199;&#x800C;&#x6253;&#x5F00;&#x8FD9;&#x4E2A; fifo &#xFF1B;</span></span><br><span class="line"><span class="comment">//&#x53EA;&#x5199;&#x6253;&#x5F00; fifo &#x4F1A;&#x963B;&#x585E;&#x7B49;&#x5F85;&#x5230;&#x67D0;&#x4E2A;&#x8FDB;&#x7A0B;&#x4E3A;&#x8BFB;&#x800C;&#x6253;&#x5F00;&#x8FD9;&#x4E2A; fifo &#xFF1B;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fifotest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">int</span> rc = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    umask(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//unlink(FIFOPATH);</span></span><br><span class="line">    <span class="comment">//rc = mkfifo(FIFOPATH, 0777);</span></span><br><span class="line">    unlink(FIFOPATH);</span><br><span class="line">    <span class="comment">//rc = mkfifo(FIFOPATH, O_CREAT | O_EXCL | O_RDWR);//&#x5199;&#x6CD5;&#x9519;&#x8BEF;</span></span><br><span class="line">    <span class="keyword">if</span>(rc &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;mkfifo&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">	pid = fork();</span><br><span class="line">	<span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	    perror(<span class="string">&quot;second fork&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) {</span><br><span class="line">	    <span class="keyword">int</span> fd = -<span class="number">1</span>;</span><br><span class="line">	    fd = open(FIFOPATH, O_RDWR);</span><br><span class="line">	    <span class="comment">//fd = open(FIFOPATH, O_WRONLY | O_APPEND);</span></span><br><span class="line">	    <span class="comment">//fd = open(FIFOPATH, O_WRONLY);</span></span><br><span class="line">	    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>) {</span><br><span class="line">		perror(<span class="string">&quot;open fifo&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line">	    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">	    num = write(fd, <span class="string">&quot;Hello &quot;</span>, <span class="keyword">sizeof</span> <span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">	    <span class="keyword">if</span>(num != <span class="keyword">sizeof</span> <span class="string">&quot;Hello &quot;</span> ) {</span><br><span class="line">		perror(<span class="string">&quot;write fifo&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line">	    num = write(fd, <span class="string">&quot;I&apos;m kyle&quot;</span>, <span class="keyword">sizeof</span> <span class="string">&quot;I&apos;m kyle&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span> {</span><br><span class="line">	    <span class="keyword">int</span> fd = -<span class="number">1</span>;</span><br><span class="line">	    fd = open(FIFOPATH, O_RDWR);</span><br><span class="line">	    <span class="comment">//fd = open(FIFOPATH, O_WRONLY | O_APPEND);</span></span><br><span class="line">	    <span class="comment">//fd = open(FIFOPATH, O_WRONLY);</span></span><br><span class="line">	    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>) {</span><br><span class="line">		perror(<span class="string">&quot;open fifo&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line">	    <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">	    num = write(fd, <span class="string">&quot;World&quot;</span>, <span class="keyword">sizeof</span> <span class="string">&quot;World&quot;</span>);</span><br><span class="line">	    <span class="keyword">if</span>(num != <span class="keyword">sizeof</span> <span class="string">&quot;World&quot;</span>) {</span><br><span class="line">		perror(<span class="string">&quot;write fifo&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">	<span class="comment">//pid = waitpid(pid, NULL, 0);</span></span><br><span class="line">	<span class="comment">//if(pid != wait(NULL)) {</span></span><br><span class="line">	<span class="comment">//    perror(&quot;wait error&quot;);</span></span><br><span class="line">	<span class="comment">//    exit(1);</span></span><br><span class="line">	<span class="comment">//}</span></span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == pid) {</span><br><span class="line">	    perror(<span class="string">&quot;firest parent&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">int</span> fd = -<span class="number">1</span>;</span><br><span class="line">	fd = open(FIFOPATH, O_RDWR);</span><br><span class="line">	<span class="comment">//fd = open(FIFOPATH, O_RDONLY);</span></span><br><span class="line">	<span class="keyword">if</span>(fd &lt; <span class="number">0</span>) {</span><br><span class="line">	    perror(<span class="string">&quot;child open fifo&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">char</span> s[<span class="number">4096</span>] = {<span class="string">&apos;\0&apos;</span>};</span><br><span class="line">	<span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>((num = read(fd, s, <span class="number">4096</span>)) != <span class="number">0</span>) {</span><br><span class="line">	    len += num;</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;read num = %d\n&quot;</span>, num);</span><br><span class="line">	    <span class="comment">//puts(s);</span></span><br><span class="line">	    write(<span class="number">1</span>, s, num);</span><br><span class="line">	    <span class="keyword">if</span>(len == <span class="number">22</span>)</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> OPENFILE <span class="string">&quot;/home/kyle/APUE/test/opentest.c&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">opentest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> rc = <span class="number">0</span>;</span><br><span class="line">    umask(<span class="number">0</span>);</span><br><span class="line">    rc = open(OPENFILE, O_RDWR | O_CREAT, <span class="number">07777</span>);</span><br><span class="line">    rc = open(OPENFILE, O_RDWR | O_CREAT);</span><br><span class="line">    <span class="keyword">if</span>(rc &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;2 arg&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writetest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">69</span>;<span class="comment">//&#x5BF9;&#x5E94; &apos;E&apos; &#x7684; ASCII &#x503C;&#xFF0C;&#x7ED3;&#x679C;&#x4F1A;&#x5728;&#x7EC8;&#x7AEF;&#x4E0A;&#x6253;&#x5370;&#x51FA; E &#xFF1B;&#x5982;&#x679C;&#x6539;&#x6210; 999 &#x90A3;&#x4E48;&#x4F1A;&#x6253;&#x5370;&#x51FA;&#x4E00;&#x4E2A;&#x6C49;&#x5B57;</span></span><br><span class="line">    write(STDOUT_FILENO, &amp;a, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">}    </span><br><span class="line"></span><br><span class="line"><span class="comment">//MQ_OPEN_MAX &#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x80FD;&#x591F;&#x540C;&#x65F6;&#x6253;&#x5F00;&#x7684;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7684;&#x6700;&#x5927;&#x6570;&#x76EE;</span></span><br><span class="line"><span class="comment">//MQ_PRIO_MAX &#x6D88;&#x606F;&#x7684;&#x6700;&#x5927;&#x4F18;&#x5148;&#x7EA7; +1</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mqtest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) {</span><br><span class="line">	sleep(<span class="number">5</span>);</span><br><span class="line">	<span class="keyword">char</span> buf[<span class="number">8192</span>] = {<span class="string">&apos;\0&apos;</span>};</span><br><span class="line">	<span class="keyword">ssize_t</span> recvlen = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">mqd_t</span> mqd = mq_open(<span class="string">&quot;/kylemq&quot;</span>, O_RDONLY);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == mqd) {</span><br><span class="line">	    perror(<span class="string">&quot;parent open mq&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">struct</span> mq_attr mqattr;</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == mq_getattr(mqd, &amp;mqattr)) {</span><br><span class="line">	    perror(<span class="string">&quot;get mq attr&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;maxmsg = %ld, mq len = %ld, current msg = %ld\n&quot;</span>,</span><br><span class="line">		mqattr.mq_maxmsg,</span><br><span class="line">		mqattr.mq_msgsize,</span><br><span class="line">		mqattr.mq_curmsgs);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">int</span> rcvpri = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//&#x63A5;&#x6536;&#x6D88;&#x606F;&#x7684; buf &#x5FC5;&#x987B;&#x5927;&#x4E8E;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x5426;&#x5219;&#x65E0;&#x6CD5;&#x63A5;&#x6536;&#x6D88;&#x606F;</span></span><br><span class="line">	<span class="comment">//Posix &#x6D88;&#x606F;&#x961F;&#x5217;&#x8BFB;&#x53D6;&#x65F6;&#x603B;&#x662F;&#x8FD4;&#x56DE;&#x6700;&#x9AD8;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x6700;&#x65E9;&#x6D88;&#x606F;&#xFF0C;&#x4E14;&#x6D88;&#x606F;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x4E00;&#x8D77;&#x8FD4;&#x56DE;</span></span><br><span class="line">	<span class="comment">//&#x6BCF;&#x6B21;&#x53EA;&#x63A5;&#x6536;&#x4E00;&#x6761;&#x6D88;&#x606F;&#xFF0C;&#x6D88;&#x606F;&#x6709;&#x8FB9;&#x754C;</span></span><br><span class="line">	<span class="comment">//&#x8BFB;&#x6D88;&#x606F;&#x961F;&#x5217;&#xFF0C;&#x53EA;&#x5728;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4E3A;&#x7A7A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x963B;&#x585E;&#x7B49;&#x5F85;&#xFF1B;&#x5199;&#x6D88;&#x606F;&#x961F;&#x5217;&#xFF0C;&#x5728;&#x961F;&#x5217;&#x6EE1;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x963B;&#x585E;&#x7B49;&#x5F85;&#xFF1B;</span></span><br><span class="line">	<span class="comment">//&#x5199;&#x4E0D;&#x7528;&#x7B49;&#x5F85;&#x8BFB;&#xFF0C;&#x8BFB;&#x4E5F;&#x4E0D;&#x7528;&#x7B49;&#x5F85;&#x5199;&#xFF1B;&#x53EF;&#x4EE5;&#x8BA9;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x521B;&#x5EFA;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7136;&#x540E;&#x7EC8;&#x6B62;&#x3001;&#x7B2C;&#x4E8C;&#x4E2A;&#x8FDB;&#x7A0B;&#x5199;&#x6D88;&#x606F;&#x961F;&#x5217;&#x7136;&#x540E;&#x7EC8;&#x6B62;&#x3001;&#x7B2C;&#x4E09;&#x4E2A;&#x8FDB;&#x7A0B;&#x8BFB;&#x6D88;&#x606F;&#x961F;&#x5217;&#xFF1B;</span></span><br><span class="line">	<span class="comment">//&#x5373;&#x8FDB;&#x7A0B;&#x7ED3;&#x675F;&#x540E;&#x6D88;&#x606F;&#x961F;&#x5217;&#x4ECD;&#x7136;&#x5B58;&#x5728;</span></span><br><span class="line">	<span class="comment">//mq_notify &#x53EF;&#x4EE5;&#x5F02;&#x6B65;&#x901A;&#x77E5;&#x8FDB;&#x7A0B;&#xFF0C;&#x6709;&#x6D88;&#x606F;&#x653E;&#x5165;&#x4E86;&#x7A7A;&#x961F;&#x5217;</span></span><br><span class="line">	recvlen = mq_receive(mqd, buf, <span class="number">8192</span>, &amp;rcvpri);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == recvlen) {</span><br><span class="line">	    perror(<span class="string">&quot;parent receive mq&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;recvpriv=%d\n&quot;</span>, rcvpri);</span><br><span class="line">	<span class="keyword">if</span>(recvlen != write(STDOUT_FILENO, buf, recvlen)) {</span><br><span class="line">	    perror(<span class="string">&quot;write to stdin&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == mq_getattr(mqd, &amp;mqattr)) {</span><br><span class="line">	    perror(<span class="string">&quot;get mq attr&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;maxmsg = %ld, mq len = %ld, current msg = %ld\n&quot;</span>,</span><br><span class="line">		mqattr.mq_maxmsg,</span><br><span class="line">		mqattr.mq_msgsize,</span><br><span class="line">		mqattr.mq_curmsgs);</span><br><span class="line"></span><br><span class="line">	recvlen = mq_receive(mqd, buf, <span class="number">8192</span>, &amp;rcvpri);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == recvlen) {</span><br><span class="line">	    perror(<span class="string">&quot;parent receive mq&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;recvpriv=%d\n&quot;</span>, rcvpri);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(recvlen != write(STDOUT_FILENO, buf, recvlen)) {</span><br><span class="line">	    perror(<span class="string">&quot;write to stdin&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	mq_close(mqd);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == mq_unlink(<span class="string">&quot;/kylemq&quot;</span>)) {</span><br><span class="line">	    perror(<span class="string">&quot;unlink after use&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">	pid = fork();</span><br><span class="line">	<span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	    perror(<span class="string">&quot;child fork&quot;</span>);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) {</span><br><span class="line">	    sleep(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">char</span> buf[<span class="number">100</span>] = {<span class="string">&apos;\0&apos;</span>};</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">mqd_t</span> mqd = mq_open(<span class="string">&quot;/kylemq&quot;</span>, O_WRONLY);</span><br><span class="line">	    <span class="keyword">if</span>(-<span class="number">1</span> == mqd) {</span><br><span class="line">		perror(<span class="string">&quot;child creat mq&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) {</span><br><span class="line">		buf[i] = <span class="string">&apos;A&apos;</span>;</span><br><span class="line">	    }</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">if</span>(-<span class="number">1</span> == mq_send(mqd, buf, <span class="number">100</span>, <span class="number">30</span>)) {</span><br><span class="line">		perror(<span class="string">&quot;child send buf&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line"></span><br><span class="line">	    mq_close(mqd);</span><br><span class="line">	    <span class="comment">//if(-1 == mq_unlink(&quot;/kylemq&quot;)) {</span></span><br><span class="line">	    <span class="comment">//    perror(&quot;unlink after use&quot;);</span></span><br><span class="line">	    <span class="comment">//}</span></span><br><span class="line"></span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="keyword">else</span> {</span><br><span class="line">	    <span class="keyword">char</span> buf[<span class="number">100</span>] = {<span class="string">&apos;\0&apos;</span>};</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">if</span>(-<span class="number">1</span> == mq_unlink(<span class="string">&quot;/kylemq&quot;</span>)) {</span><br><span class="line">		perror(<span class="string">&quot;unlink before creat&quot;</span>);</span><br><span class="line">	    }</span><br><span class="line">	    <span class="keyword">mqd_t</span> mqd = mq_open(<span class="string">&quot;/kylemq&quot;</span>, O_WRONLY | O_CREAT | O_EXCL, <span class="number">0777</span>, <span class="literal">NULL</span>);</span><br><span class="line">	    <span class="keyword">if</span>(-<span class="number">1</span> == mqd) {</span><br><span class="line">		perror(<span class="string">&quot;child creat mq&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) {</span><br><span class="line">		buf[i] = <span class="string">&apos;C&apos;</span>;</span><br><span class="line">	    }</span><br><span class="line"></span><br><span class="line">	    <span class="keyword">if</span>(-<span class="number">1</span> == mq_send(mqd, buf, <span class="number">100</span>, <span class="number">10</span>)) {</span><br><span class="line">		perror(<span class="string">&quot;child send buf&quot;</span>);</span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	    }</span><br><span class="line"></span><br><span class="line">	    mq_close(mqd);</span><br><span class="line"></span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	}</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> shm_mutx {</span><br><span class="line">    <span class="keyword">sem_t</span> mutex;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">};</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shmtest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">//shm_open &#x7684;&#x6743;&#x9650;&#x4F4D;&#x603B;&#x662F;&#x5FC5;&#x987B;&#x6307;&#x5B9A;</span></span><br><span class="line">    <span class="comment">//shm_open &#x65B0;&#x521B;&#x5EFA;&#x7684;&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x533A;&#x5BF9;&#x8C61;&#x7684;&#x5927;&#x5C0F;&#x4E3A;&#x96F6;&#xFF0C;&#x5FC5;&#x987B;&#x4F7F;&#x7528; ftruncate &#x4FEE;&#x6539;&#x5927;&#x5C0F;</span></span><br><span class="line">    <span class="keyword">int</span> shmd = shm_open(<span class="string">&quot;/kyleshm&quot;</span>, O_RDWR | O_CREAT, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == shmd) {</span><br><span class="line">	perror(<span class="string">&quot;creat shm&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x666E;&#x901A;&#x6587;&#x4EF6;&#x6269;&#x5C55;&#xFF0C;&#x6269;&#x5C55;&#x90E8;&#x5206;&#x586B;&#x5145;&#x4E3A;&#x96F6;&#xFF1B;</span></span><br><span class="line">    <span class="comment">//&#x5171;&#x4EAB;&#x5185;&#x5B58;&#x6269;&#x5C55;&#x90E8;&#x5206;&#x4E0D;&#x4E00;&#x5B9A;&#x4E3A;&#x96F6;&#x3002;</span></span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == ftruncate(shmd, <span class="keyword">sizeof</span>(<span class="keyword">int</span>))) {</span><br><span class="line">	perror(<span class="string">&quot;change shm size&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> stat shmstat;</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == fstat(shmd, &amp;shmstat)) {</span><br><span class="line">	perror(<span class="string">&quot;get shm stat&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;shm size = %ld\n&quot;</span>, shmstat.st_size);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> *pshm = <span class="literal">NULL</span>;</span><br><span class="line">    pshm = mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>), PROT_READ | PROT_WRITE, MAP_SHARED, shmd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(MAP_FAILED == pshm) {</span><br><span class="line">	perror(<span class="string">&quot;mmap shm&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">sem_t</span> *mutex;</span><br><span class="line">    <span class="keyword">if</span>(SEM_FAILED == (mutex = sem_open(<span class="string">&quot;/kylemutex&quot;</span>, O_CREAT | O_EXCL, <span class="number">0777</span>, <span class="number">1</span>))) {</span><br><span class="line">	perror(<span class="string">&quot;creat mutex&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    sem_unlink(<span class="string">&quot;kylemutex&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">	*pshm = <span class="number">6543210</span>;</span><br><span class="line">	sem_wait(mutex);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;child read shm value = %d\n&quot;</span>, *pshm);</span><br><span class="line">	*pshm = <span class="number">6543210</span>;</span><br><span class="line">	sem_post(mutex);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">	<span class="comment">//sleep(1);</span></span><br><span class="line"></span><br><span class="line">	sem_wait(mutex);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;parent read shm value = %d\n&quot;</span>, *pshm);</span><br><span class="line">	*pshm = <span class="number">123456</span>;</span><br><span class="line">	sem_post(mutex);</span><br><span class="line"></span><br><span class="line">	shm_unlink(<span class="string">&quot;kyleshm&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//mmap &#x6D4B;&#x8BD5;</span></span><br><span class="line"><span class="comment">//mmap &#x6620;&#x5C04;&#x5230;&#x5185;&#x5B58;&#x7684;&#x5927;&#x5C0F;&#x5C0F;&#x4E8E;&#x6587;&#x4EF6;&#x7684;&#x5927;&#x5C0F;&#xFF0C;&#x4ECD;&#x7136;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x6307;&#x9488;&#x8BBE;&#x7F6E;&#x672A;&#x6620;&#x5C04;&#x5230;&#x5185;&#x5B58;&#x7684;&#x7A7A;&#x95F4;&#x4F46;&#x8FD8;&#x5728;&#x6587;&#x4EF6;&#x957F;&#x5EA6;&#x8303;&#x56F4;&#x5185;&#x7684;&#x503C;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mmaptest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="comment">//int fd = open(&quot;foo&quot;, O_RDWR | O_CREAT | O_TRUNC, 0777);</span></span><br><span class="line">    <span class="keyword">int</span> fd = shm_open(<span class="string">&quot;kyleshm&quot;</span>, O_RDWR | O_CREAT, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == fd ) {</span><br><span class="line">	perror(<span class="string">&quot;open foo&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    ftruncate(fd, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">char</span> *<span class="built_in">string</span> = <span class="string">&quot;YYYYYYYYYY&quot;</span>;</span><br><span class="line">    write(fd, <span class="built_in">string</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *pshmd = mmap(<span class="literal">NULL</span>, <span class="number">8</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fd, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(MAP_FAILED == pshmd) {</span><br><span class="line">	perror(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pagesize = sysconf(_SC_PAGESIZE);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;pagesize=%d\n&quot;</span>, pagesize);</span><br><span class="line">    *pshmd = <span class="string">&apos;b&apos;</span>;</span><br><span class="line">    *(pshmd + <span class="number">7</span>) = <span class="string">&apos;e&apos;</span>;</span><br><span class="line">    *(pshmd + <span class="number">8</span>) = <span class="string">&apos;n&apos;</span>;</span><br><span class="line">    *(pshmd + <span class="number">9</span>) = <span class="string">&apos;e&apos;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ftruncate(fd, 12288);</span></span><br><span class="line">    *(pshmd + <span class="number">4095</span>) = <span class="string">&apos;e&apos;</span>;</span><br><span class="line">    *(pshmd + <span class="number">4096</span>) = <span class="string">&apos;e&apos;</span>;</span><br><span class="line">    *(pshmd + <span class="number">9192</span>) = <span class="string">&apos;e&apos;</span>;</span><br><span class="line">    *(pshmd + <span class="number">12288</span>) = <span class="string">&apos;e&apos;</span>;</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x6D4B;&#x8BD5;&#x5728;&#x8FDB;&#x7A0B;&#x7684;&#x6E05;&#x7406;&#x51FD;&#x6570;&#x4E2D;&#x91CA;&#x653E;&#x9501;</span></span><br><span class="line"><span class="keyword">struct</span> data {</span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> data *something;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanprocess</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;excute the unlock clean\n&quot;</span>);</span><br><span class="line">    pthread_mutex_unlock(&amp;(something-&gt;mutex));</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">unlockInAtexit</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> shmd = shm_open(<span class="string">&quot;/kyleshm&quot;</span>, O_RDWR | O_CREAT, <span class="number">0777</span>);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == shmd) {</span><br><span class="line">	perror(<span class="string">&quot;creat shm&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == ftruncate(shmd, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> data))) {</span><br><span class="line">	perror(<span class="string">&quot;change the shm size&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> data *pdata = mmap(<span class="literal">NULL</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> data), PROT_READ | PROT_WRITE, MAP_SHARED, shmd, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(MAP_FAILED == pdata) {</span><br><span class="line">	perror(<span class="string">&quot;create mmap&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    pthread_mutex_init(&amp;(pdata-&gt;mutex), <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    something = pdata;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">	atexit(cleanprocess);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;child process\n&quot;</span>);</span><br><span class="line">	pthread_mutex_lock(&amp;(pdata-&gt;mutex));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;value = %d\n&quot;</span>, pdata-&gt;value);</span><br><span class="line">	pdata-&gt;value = <span class="number">123456</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">	sleep(<span class="number">3</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;parent process\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">	pthread_mutex_lock(&amp;(pdata-&gt;mutex));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;value = %d\n&quot;</span>, pdata-&gt;value);</span><br><span class="line">	pdata-&gt;value = <span class="number">98765</span>;</span><br><span class="line">	pthread_mutex_unlock(&amp;(pdata-&gt;mutex));</span><br><span class="line"></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">pthread_mutex_t</span> mutex = PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"><span class="keyword">int</span> meimei = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">fun1</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    meimei = <span class="number">12345</span>;</span><br><span class="line">    meimei = <span class="number">12346</span>;</span><br><span class="line">    meimei = <span class="number">12347</span>;</span><br><span class="line">    meimei = <span class="number">12348</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;meimei = %d\n&quot;</span>, meimei);</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1234</span> != pthread_mutex_unlock(&amp;mutex)) {</span><br><span class="line">	perror(<span class="string">&quot;unlock mutex&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1234</span> != pthread_mutex_unlock(&amp;mutex)) {</span><br><span class="line">	perror(<span class="string">&quot;unlock mutex&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//pthread_exit(0);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">fun2</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    pthread_mutex_lock(&amp;mutex);</span><br><span class="line">    meimei = <span class="number">9876</span>;</span><br><span class="line">    meimei = <span class="number">9874</span>;</span><br><span class="line">    meimei = <span class="number">9873</span>;</span><br><span class="line">    meimei = <span class="number">9872</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;meimei = %d\n&quot;</span>, meimei);</span><br><span class="line">    pthread_mutex_unlock(&amp;mutex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//pthread_exit(0);</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pthreadtest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">int</span> producenum = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">pthread_t</span> produceID[producenum];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> != pthread_create(&amp;produceID[<span class="number">0</span>], <span class="literal">NULL</span>, fun1, <span class="literal">NULL</span>)) {</span><br><span class="line">	perror(<span class="string">&quot;create pthread&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> != pthread_create(&amp;produceID[<span class="number">1</span>], <span class="literal">NULL</span>, fun2, <span class="literal">NULL</span>)) {</span><br><span class="line">	perror(<span class="string">&quot;create pthread&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    pthread_join(produceID[<span class="number">0</span>], <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(produceID[<span class="number">1</span>], <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x7ED9;&#x5B9A;&#x5B57;&#x8282;&#xFF0C;&#x540C;&#x4E00;&#x4E2A;&#x8C03;&#x7528;&#x8FDB;&#x7A0B;&#x540E;&#x6765;&#x8BBE;&#x7F6E;&#x7684;&#x503C;&#x4F1A;&#x8986;&#x76D6;&#x6389;&#x4E4B;&#x524D;&#x8BBE;&#x7F6E;&#x7684;&#x503C;&#x3002;</span></span><br><span class="line"><span class="comment">//&#x6CA1;&#x6709;&#x8BB0;&#x5F55;&#x9501;&#x7684;&#x7C7B;&#x578B;&#x662F;&#x8BFB;&#x5199;&#x9501;&#xFF0C;&#x53EA;&#x6709;&#x8BFB;&#x9501;&#x3001;&#x5199;&#x9501;&#x3001;&#x6CA1;&#x6709;&#x9501;&#x4E09;&#x79CD;</span></span><br><span class="line"><span class="comment">//&#x800C;&#x4E14;&#x540C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5229;&#x7528; f_GETLK &#x67E5;&#x770B;&#xFF0C;&#x59CB;&#x7EC8;&#x4F1A;&#x5F97;&#x5230; F_UNLCK &#x3002;&#x65E0;&#x8BBA;&#x8BE5;&#x5B57;&#x8282;&#x662F;&#x5426;&#x5DF2;&#x7ECF;&#x8BBE;&#x7F6E;&#x4E0A;&#x9501;&#x3002;&#xFF08;&#x524D;&#x63D0;&#x662F;&#x6CA1;&#x6709;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x4E0A;&#x9501;&#xFF09;</span></span><br><span class="line"><span class="comment">//&#x53EA;&#x6709;&#x88AB;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x9501;&#x5B9A;&#x624D;&#x4F1A;&#x83B7;&#x53D6;&#x5230;&#x9501;&#x7684;&#x7C7B;&#x578B;</span></span><br><span class="line"><span class="comment">//Posix &#x8BB0;&#x5F55;&#x9501;&#x662F;&#x529D;&#x544A;&#x6027;&#x4E0A;&#x9501;&#xFF08;advisory locking&#xFF09;&#xFF1B;</span></span><br><span class="line"><span class="comment">//&#x4E66;&#x4E0A;&#x5199;&#xFF0C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x65E0;&#x89C6;&#x4E00;&#x4E2A;&#x529D;&#x544A;&#x6027;&#x9501;&#x800C;&#x5199;&#x4E00;&#x4E2A;&#x8BFB;&#x9501;&#x5B9A;&#x6587;&#x4EF6;&#xFF0C;&#x6216;&#x8005;&#x8BFB;&#x4E00;&#x4E2A;&#x5199;&#x9501;&#x5B9A;&#x6587;&#x4EF6;&#xFF1B;(&#x8FDB;&#x7A0B;&#x6709;&#x5BF9;&#x8BE5;&#x6587;&#x4EF6;&#x76F8;&#x5E94;&#x64CD;&#x4F5C;&#x7684;&#x6743;&#x9650;)</span></span><br><span class="line"><span class="comment">//&#x81EA;&#x5DF1;&#x6D4B;&#x8BD5;&#x53D1;&#x73B0;&#x53CA;&#x65F6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4F7F;&#x7528;&#x529D;&#x544A;&#x6027;&#x5199;&#x9501;&#x9501;&#x4F4F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#xFF0C;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4EFB;&#x7136;&#x53EF;&#x4EE5;&#x5199;&#x8BE5;&#x6587;&#x4EF6;&#x3002;</span></span><br><span class="line"><span class="comment">//&#x8BB0;&#x5F55;&#x9501;&#x4E0D;&#x5E94;&#x8BE5;&#x540C;&#x6807;&#x51C6; I/O &#x5E93;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x8BE5;&#x51FD;&#x6570;&#x5E93;&#x4F1A;&#x6267;&#x884C;&#x5185;&#x90E8;&#x7F13;&#x51B2;&#x3002;&#x5F53;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x8BB0;&#x5F55;&#x9501;&#x65F6;&#xFF0C;&#x4E3A;&#x907F;&#x514D;&#x95EE;&#x9898;&#xFF0C;&#x5E94;&#x5BF9;&#x5176;&#x4F7F;&#x7528; read &#x3001;write &#x51FD;&#x6570;&#x3002;</span></span><br><span class="line"><span class="comment">//&#x5982;&#x679C;&#x7CFB;&#x7EDF;&#x652F;&#x6301;&#x5F3A;&#x5236;&#x6027;&#x9501;&#xFF0C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x5BF9;&#x67D0;&#x4E9B;&#x5B57;&#x8282;&#x4E0A;&#x9501;&#xFF0C;&#x5176;&#x4ED6;&#x8FDB;&#x7A0B;&#x5728;&#x8C03;&#x7528; read/write &#x65F6;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x9501;&#x88AB;&#x6253;&#x5F00;&#xFF1B;</span></span><br><span class="line"><span class="comment">//&#x4F46;&#x662F;&#x4EFB;&#x7136;&#x65E0;&#x6CD5;&#x4FDD;&#x8BC1;&#x7A0B;&#x5E8F;&#x4E0D;&#x51FA;&#x73B0;&#x6DF7;&#x4E71;&#xFF0C;&#x4F8B;&#x5982;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x9996;&#x5148;&#x8BFB;&#x53D6;&#x4E86;&#x53D7;&#x4FDD;&#x62A4;&#x53D8;&#x91CF;&#x7684;&#x503C;&#xFF0C;&#x7136;&#x540E;&#x5185;&#x6838;&#x5207;&#x6362;&#x8FDB;&#x7A0B;&#xFF0C;</span></span><br><span class="line"><span class="comment">//&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x9501;&#x4F4F;&#x6587;&#x4EF6;&#xFF0C;&#x4FEE;&#x6539;&#x53D8;&#x91CF;&#xFF0C;&#x91CA;&#x653E;&#x9501;&#xFF1B;</span></span><br><span class="line"><span class="comment">//&#x6B64;&#x65F6;&#x524D;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x88AB;&#x5185;&#x6838;&#x8C03;&#x5EA6;&#x56DE;&#x6765;&#xFF0C;&#x4F9D;&#x636E;&#x521A;&#x624D;&#x8BFB;&#x53D6;&#x7684;&#x503C;&#x505A;&#x64CD;&#x4F5C;&#xFF08;&#x7531;&#x4E8E;&#x8BE5;&#x503C;&#x5DF2;&#x88AB;&#x53E6;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x4FEE;&#x6539;&#xFF0C;&#x6240;&#x4EE5;&#x662F;&#x9519;&#x8BEF;&#x7684;&#x503C;&#xFF09;&#xFF0C;&#x5BFC;&#x81F4;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x4E3A;&#x3002;</span></span><br><span class="line"><span class="comment">//&#x591A;&#x4E2A;&#x8FDB;&#x7A0B;&#x540C;&#x65F6;&#x64CD;&#x4F5C;&#x67D0;&#x4E2A;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x5FC5;&#x987B;&#x90FD;&#x5F97;&#x4E0A;&#x9501;&#xFF0C;&#x5426;&#x5219;&#x8FDD;&#x89C4;&#x5C31;&#x53EF;&#x80FD;&#x53D1;&#x751F;&#x3002;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fcntltest</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line">    <span class="keyword">struct</span> flock flock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> fd = open(<span class="string">&quot;foo&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(-<span class="number">1</span> == fd) {</span><br><span class="line">	perror(<span class="string">&quot;open foo&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;F_RDLCK=%d\n&quot;</span>, F_RDLCK);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;F_WRLCK=%d\n&quot;</span>, F_WRLCK);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;F_UNLCK=%d\n&quot;</span>, F_UNLCK);</span><br><span class="line"></span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) {</span><br><span class="line">	perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(<span class="number">0</span> == pid) {</span><br><span class="line">	flock.l_type = F_WRLCK;</span><br><span class="line">	flock.l_whence = SEEK_SET;</span><br><span class="line">	flock.l_start = <span class="number">0</span>;</span><br><span class="line">	flock.l_len = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> rc = fcntl(fd, F_GETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;child get flock&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;child flock type : %d; lock pid = %d\n&quot;</span>,</span><br><span class="line">		flock.l_type, flock.l_pid);</span><br><span class="line"></span><br><span class="line">	flock.l_type = F_WRLCK;</span><br><span class="line">	flock.l_whence = SEEK_SET;</span><br><span class="line">	flock.l_start = <span class="number">0</span>;</span><br><span class="line">	flock.l_len = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	rc = fcntl(fd, F_SETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;child set write flock&quot;</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	flock.l_type = F_RDLCK;</span><br><span class="line">	flock.l_whence = SEEK_SET;</span><br><span class="line">	flock.l_start = <span class="number">0</span>;</span><br><span class="line">	flock.l_len = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	rc = fcntl(fd, F_SETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;child set read flock&quot;</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">1024</span>];</span><br><span class="line">	lseek(fd, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">	<span class="keyword">int</span> rdlen = read(fd, str, <span class="number">1024</span>);</span><br><span class="line">	write(STDOUT_FILENO, str, rdlen);</span><br><span class="line">	write(STDOUT_FILENO, <span class="string">&quot;\n&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">	lseek(fd, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">	rc = write(fd, <span class="string">&quot;zxcvbn&quot;</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="number">6</span> != rc) {</span><br><span class="line">	    perror(<span class="string">&quot;write file when flock by parent&quot;</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	lseek(fd, <span class="number">0</span>, SEEK_SET);</span><br><span class="line">	rdlen = read(fd, str, <span class="number">1024</span>);</span><br><span class="line">	write(STDOUT_FILENO, str, rdlen);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">	flock.l_type = F_WRLCK;</span><br><span class="line">	flock.l_whence = SEEK_SET;</span><br><span class="line">	flock.l_start = <span class="number">0</span>;</span><br><span class="line">	flock.l_len = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> rc = fcntl(fd, F_SETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;set flock&quot;</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	rc = fcntl(fd, F_GETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;get flock 1&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;flock type : %d; lock pid = %d\n&quot;</span>,</span><br><span class="line">		flock.l_type, flock.l_pid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	flock.l_type = F_RDLCK;</span><br><span class="line">	flock.l_whence = SEEK_SET;</span><br><span class="line">	flock.l_start = <span class="number">0</span>;</span><br><span class="line">	flock.l_len = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	rc = fcntl(fd, F_SETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;set flock&quot;</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	rc = fcntl(fd, F_GETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;get flock 2&quot;</span>);</span><br><span class="line">	}</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;flock type : %d; lock pid = %d\n&quot;</span>,</span><br><span class="line">		flock.l_type, flock.l_pid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	flock.l_type = F_WRLCK;</span><br><span class="line">	flock.l_whence = SEEK_SET;</span><br><span class="line">	flock.l_start = <span class="number">0</span>;</span><br><span class="line">	flock.l_len = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	rc = fcntl(fd, F_SETLK, &amp;flock);</span><br><span class="line">	<span class="keyword">if</span>(-<span class="number">1</span> == rc) {</span><br><span class="line">	    perror(<span class="string">&quot;parent set write flock&quot;</span>);</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	sleep(<span class="number">5</span>);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div>
</div>
</div>

<div id="outline-container-org3da1a7c" class="outline-3">
<h3 id="org3da1a7c"><span class="section-number-3">5.3</span> pthread</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn</span><span class="params">(<span class="keyword">void</span> *arg)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn2</span><span class="params">(<span class="keyword">void</span> *arg)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> globalnum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> c = <span class="string">&apos;s&apos;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pthread_t</span> ntid;</span><br><span class="line">    <span class="keyword">pthread_t</span> ntid2;</span><br><span class="line">    <span class="keyword">void</span> *tret;</span><br><span class="line">    <span class="keyword">int</span> rc = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> mutexlock;</span><br><span class="line"></span><br><span class="line">    pthread_mutex_init(&amp;mutexlock, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> != (rc = pthread_create(&amp;ntid, <span class="literal">NULL</span>, thr_fn, &amp;mutexlock))) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span> != (rc = pthread_create(&amp;ntid2, <span class="literal">NULL</span>, thr_fn2, &amp;mutexlock))) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;main thread: pid = %lu, ppid = %lu, tid = %lu (0x%lx)\n&quot;</span>,</span><br><span class="line">	    getpid(), getppid(), pthread_self(), pthread_self());</span><br><span class="line"></span><br><span class="line">    pthread_mutex_lock(&amp;mutexlock);</span><br><span class="line">    globalnum += <span class="number">10</span>;</span><br><span class="line">    c = <span class="string">&apos;k&apos;</span>;</span><br><span class="line">    pthread_mutex_unlock(&amp;mutexlock);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;num = %d, c = %c\n&quot;</span>, globalnum, c);</span><br><span class="line"></span><br><span class="line">    pthread_join(ntid, &amp;tret);</span><br><span class="line">    pthread_join(ntid2, &amp;tret);</span><br><span class="line"></span><br><span class="line">    pthread_mutex_destroy(&amp;mutexlock);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn</span><span class="params">(<span class="keyword">void</span> *arg)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;new thread: pid = %lu, ppid = %lu, tid = %lu (0x%lx)\n&quot;</span>,</span><br><span class="line">	    getpid(), getppid(), pthread_self(), pthread_self());</span><br><span class="line"></span><br><span class="line">    pthread_mutex_lock(arg);</span><br><span class="line">    globalnum += <span class="number">100</span>;</span><br><span class="line">    c = <span class="string">&apos;y&apos;</span>;</span><br><span class="line">    pthread_mutex_unlock(arg);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;num = %d, c = %c\n&quot;</span>, globalnum, c);</span><br><span class="line"></span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thr_fn2</span><span class="params">(<span class="keyword">void</span> *arg)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;new thread: pid = %lu, ppid = %lu, tid = %lu (0x%lx)\n&quot;</span>,</span><br><span class="line">	    getpid(), getppid(), pthread_self(), pthread_self());</span><br><span class="line"></span><br><span class="line">    pthread_mutex_lock(arg);</span><br><span class="line">    globalnum += <span class="number">1000</span>;</span><br><span class="line">    c = <span class="string">&apos;l&apos;</span>;</span><br><span class="line">    pthread_mutex_unlock(arg);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;num = %d, c = %c\n&quot;</span>, globalnum, c);</span><br><span class="line"></span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>


<div class="org-src-container">
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">&lt;signal.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">define</span> PIPETOAYC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">sig_atomic_t</span> sigflag;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">sigset_t</span> newmask, oldmask, zeromask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> child2parentfd[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> parent2childfd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">charatatime</span><span class="params">(<span class="keyword">char</span> *str)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_usr</span><span class="params">(<span class="keyword">int</span> signo)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_WAIT</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_CHILD</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_CHILD</span><span class="params">(pid_t pid)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_PARENT</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_PARENT</span><span class="params">(pid_t pid)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid;</span><br><span class="line"></span><br><span class="line">    TELL_WAIT();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>((pid = fork()) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid &gt; <span class="number">0</span>) {</span><br><span class="line">	WAIT_CHILD();</span><br><span class="line">	charatatime(<span class="string">&quot;Parent do whatever is necessary ...\n&quot;</span>);</span><br><span class="line">	TELL_CHILD(pid);</span><br><span class="line">	<span class="comment">//charatatime(&quot;GO on to do something in parent\n&quot;);</span></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">	charatatime(<span class="string">&quot;Child do whatever is necessary ...\n&quot;</span>);</span><br><span class="line">	TELL_PARENT(getppid());</span><br><span class="line">	WAIT_PARENT();</span><br><span class="line">	<span class="comment">//charatatime(&quot;GO on to do something in parent\n&quot;);</span></span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> SIGTOSYC</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sig_usr</span><span class="params">(<span class="keyword">int</span> signo)</span></span><br><span class="line"></span>{</span><br><span class="line">    sigflag = <span class="number">1</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_WAIT</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">if</span>(SIG_ERR == signal(SIGUSR1, sig_usr)) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(SIG_ERR == signal(SIGUSR2, sig_usr)) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    sigemptyset(&amp;newmask);</span><br><span class="line">    sigemptyset(&amp;zeromask);</span><br><span class="line">    sigaddset(&amp;newmask, SIGUSR1);</span><br><span class="line">    sigaddset(&amp;newmask, SIGUSR2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sigprocmask(SIG_BLOCK, &amp;newmask, &amp;oldmask) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_CHILD</span><span class="params">(pid_t pid)</span></span><br><span class="line"></span>{</span><br><span class="line">    kill(pid, SIGUSR1);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_CHILD</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">0</span> == sigflag) { <span class="comment">//&#x53EF;&#x80FD;&#x6709;&#x5176;&#x4ED6;&#x4FE1;&#x53F7;&#x5524;&#x9192;&#x8FDB;&#x7A0B;</span></span><br><span class="line">	sigsuspend(&amp;zeromask);</span><br><span class="line">    }</span><br><span class="line">    sigflag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sigprocmask(SIG_SETMASK, &amp;oldmask, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_PARENT</span><span class="params">(pid_t pid)</span></span><br><span class="line"></span>{</span><br><span class="line">    kill(pid, SIGUSR2);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_PARENT</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">0</span> == sigflag) {</span><br><span class="line">	sigsuspend(&amp;zeromask);</span><br><span class="line">    }</span><br><span class="line">    sigflag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sigprocmask(SIG_SETMASK, &amp;oldmask, <span class="literal">NULL</span>) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">ifdef</span> PIPETOAYC</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_WAIT</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">if</span>(pipe(child2parentfd) &lt; <span class="number">0</span> || pipe(parent2childfd) &lt; <span class="number">0</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_PARENT</span><span class="params">(pid_t pid)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">if</span>(write(child2parentfd[<span class="number">1</span>], <span class="string">&quot;c&quot;</span>, <span class="number">1</span>) != <span class="number">1</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_PARENT</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">if</span>(read(parent2childfd[<span class="number">0</span>], &amp;c, <span class="number">1</span>) != <span class="number">1</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c != <span class="string">&apos;p&apos;</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TELL_CHILD</span><span class="params">(pid_t pid)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">if</span>(write(parent2childfd[<span class="number">1</span>], <span class="string">&quot;p&quot;</span>, <span class="number">1</span>) != <span class="number">1</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WAIT_CHILD</span><span class="params">()</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">if</span>(read(child2parentfd[<span class="number">0</span>], &amp;c, <span class="number">1</span>) != <span class="number">1</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(c != <span class="string">&apos;c&apos;</span>) {</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="preprocessor">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">charatatime</span><span class="params">(<span class="keyword">char</span> *str)</span></span><br><span class="line"></span>{</span><br><span class="line">    <span class="keyword">char</span> *ptr = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">for</span>(ptr = str; (c = *ptr++) != <span class="number">0</span>; ) {</span><br><span class="line">	putc(c, <span class="built_in">stdout</span>);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</div>
</div>
</div>
</div>
</div>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
            <a href="/tags/C/" rel="tag"># C</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/11/18/emotion/emotion/" rel="next" title="情商">
                <i class="fa fa-chevron-left"></i> 情商
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/12/07/book/how-to-read-a-book/" rel="prev" title="How to read a book">
                How to read a book <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNzU0Ny8xNDA3OQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/polarbear.jpg"
                alt="Kyle Three Stone" />
            
              <p class="site-author-name" itemprop="name">Kyle Three Stone</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">22</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/chinasanshi" title="GitHub" target="_blank">GitHub</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="mailto:kyleemail@163.com" title="E-Mail" target="_blank">E-Mail</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#orgb87e177"><span class="nav-text">1 I/O</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#orgbb7b4f4"><span class="nav-text">1.1 文件 I/O</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#orge82eb6c"><span class="nav-text">1.1.1 管道读写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orgd9fe3a4"><span class="nav-text">1.1.2 套接字描述符</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org3cc09c9"><span class="nav-text">1.1.3 改变文件偏移量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orga4edab8"><span class="nav-text">1.2 标准库 I/O</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#org7410985"><span class="nav-text">1.2.1 定位流</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#org7db7ee9"><span class="nav-text">2 IPC</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#org5fe9390"><span class="nav-text">2.1 消息边界</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#org8d03930"><span class="nav-text">2.1.1 无边界</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orga879a28"><span class="nav-text">2.1.2 有边界</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orgd154507"><span class="nav-text">2.2 窥探能力</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#org2585eac"><span class="nav-text">2.2.1 可以窥探</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org79eae5f"><span class="nav-text">2.2.2 不可窥探</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org2c1da2a"><span class="nav-text">2.3 读取顺序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#org1e3e343"><span class="nav-text">2.3.1 先进先出</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org4661108"><span class="nav-text">2.3.2 优先级最高的最早消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orgfa8c17a"><span class="nav-text">2.3.3 指定优先级的消息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orgaf617a9"><span class="nav-text">2.4 对象持续性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#orgec91aec"><span class="nav-text">2.4.1 随进程持续 process-persistent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orgbbefa79"><span class="nav-text">2.4.2 随内核持续 kernel-persistent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orgea6a375"><span class="nav-text">2.4.3 随文件系统持续 filesystem-persistent</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orgf2059e8"><span class="nav-text">2.5 名字空间 – name space</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#orgd6fa158"><span class="nav-text">2.5.1 打开 IPC 名字空间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orgf932702"><span class="nav-text">2.5.2 打开 IPC 后的标识</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#orgd7fba1c"><span class="nav-text">2.5.3 需要定义结构体变量–指针</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org2dd291d"><span class="nav-text">2.6 fork、exec、exit 对 IPC 的影响</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org6f0407f"><span class="nav-text">2.7 锁释放</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#orgc21ee60"><span class="nav-text">2.7.1 内核自动释放</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#org89bbb47"><span class="nav-text">2.7.2 无法释放锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org6e2d03a"><span class="nav-text">2.8 进程、线程与共享信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#org534e613"><span class="nav-text">3 进程 – 线程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#org388b644"><span class="nav-text">3.1 设计线程的原因：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org9f1829b"><span class="nav-text">3.2 线程共享全局内存空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org051b99d"><span class="nav-text">3.3 线程共享的资源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org355de89"><span class="nav-text">3.4 线程私有资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#orgee89979"><span class="nav-text">4 系统开销</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#orgb7e7124"><span class="nav-text">5 练习代码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#orgdcdb64c"><span class="nav-text">5.1 基本函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orgdb9d585"><span class="nav-text">5.2 IPC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#org3da1a7c"><span class="nav-text">5.3 pthread</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kyle Three Stone</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total">1.3m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="Reading time total">20:false</span>
  
</div>











        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" title="Total Visitors">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="site-pv" title="Total Views">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Wechat,Weibo,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

  

  

</body>
</html>
